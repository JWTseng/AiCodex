<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TG3 舒适音效测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .section {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .section h2 {
            color: #ffd700;
            margin-top: 0;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }
        .game-container {
            text-align: center;
            margin: 20px 0;
        }
        .game-frame {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: #000;
            margin: 20px auto;
            display: block;
        }
        .info-box {
            background: rgba(33, 150, 243, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
        .info-box h3 {
            color: #2196f3;
            margin-top: 0;
        }
        .success-box {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            margin: 15px 0;
        }
        .success-box h3 {
            color: #4caf50;
            margin-top: 0;
        }
        .warning-box {
            background: rgba(255, 152, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
            margin: 15px 0;
        }
        .warning-box h3 {
            color: #ff9800;
            margin-top: 0;
        }
        .sound-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .sound-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: bold;
        }
        .sound-button:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: #ffd700;
            transform: translateY(-2px);
        }
        .sound-button:active {
            transform: translateY(0);
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .comparison-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            font-weight: bold;
        }
        .comparison-table td {
            background: rgba(255, 255, 255, 0.1);
        }
        .comfortable {
            background: rgba(76, 175, 80, 0.2) !important;
            color: #4caf50 !important;
            font-weight: bold;
        }
        .latency-info {
            background: rgba(156, 39, 176, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #9c27b0;
            margin: 15px 0;
        }
        .latency-info h3 {
            color: #9c27b0;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎵 TG3 舒适音效测试</h1>
        
        <div class="success-box">
            <h3>✅ 新舒适音效方案已实施</h3>
            <p>基于现代音效设计理念，在保持经典俄罗斯方块特色的基础上，创造更舒适的听觉体验。</p>
        </div>

        <div class="section">
            <h2>🎯 舒适音效设计特点</h2>
            
            <div class="comparison-table">
                <thead>
                    <tr>
                        <th>音效类型</th>
                        <th>经典版本</th>
                        <th>舒适版本</th>
                        <th>改进说明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>移动音效</strong></td>
                        <td>900Hz方波, 60ms</td>
                        <td class="comfortable">600Hz正弦波, 80ms</td>
                        <td>降低频率，使用正弦波，更柔和</td>
                    </tr>
                    <tr>
                        <td><strong>旋转音效</strong></td>
                        <td>1100Hz方波, 80ms</td>
                        <td class="comfortable">800Hz三角波, 100ms</td>
                        <td>使用三角波，增加持续时间</td>
                    </tr>
                    <tr>
                        <td><strong>锁定音效</strong></td>
                        <td>300Hz三角波, 120ms</td>
                        <td class="comfortable">200Hz正弦波, 150ms</td>
                        <td>更低频率，更长的衰减</td>
                    </tr>
                    <tr>
                        <td><strong>消行音效</strong></td>
                        <td>1400Hz方波, 180ms</td>
                        <td class="comfortable">1000Hz正弦波→1500Hz, 200ms</td>
                        <td>使用正弦波，更自然的上升</td>
                    </tr>
                    <tr>
                        <td><strong>升级音效</strong></td>
                        <td>600→1800Hz方波, 400ms</td>
                        <td class="comfortable">500→1200Hz正弦波, 500ms</td>
                        <td>降低频率范围，延长持续时间</td>
                    </tr>
                    <tr>
                        <td><strong>游戏结束</strong></td>
                        <td>400→100Hz锯齿波, 500ms</td>
                        <td class="comfortable">300→80Hz正弦波, 600ms</td>
                        <td>使用正弦波，更自然的下降</td>
                    </tr>
                </tbody>
            </div>
        </div>

        <div class="latency-info">
            <h3>⚡ 低延迟同步优化</h3>
            <p><strong>关键改进</strong>：确保音效和操作保持完美同步，延迟控制在1ms以内</p>
            <ul>
                <li>使用 <code>requestAnimationFrame</code> 确保音效在下一帧播放</li>
                <li>AudioContext 配置为 <code>latencyHint: 'interactive'</code></li>
                <li>音效播放延迟设置为 1ms</li>
                <li>使用精确的时间戳控制播放时机</li>
                <li>避免阻塞主线程的音效处理</li>
            </ul>
        </div>

        <div class="section">
            <h2>🎮 游戏测试</h2>
            
            <div class="info-box">
                <h3>📋 测试步骤</h3>
                <ol>
                    <li>点击下方"加载TG3游戏"按钮</li>
                    <li>点击游戏区域激活音频</li>
                    <li>按Enter键开始游戏</li>
                    <li>测试各种操作，感受舒适音效</li>
                    <li>特别注意音效与操作的同步性</li>
                </ol>
            </div>
            
            <div class="game-container">
                <button id="loadGame" class="sound-button">🎮 加载TG3游戏</button>
                <div id="gameFrame" style="display: none;">
                    <iframe id="tg3Game" class="game-frame" width="400" height="600" src=""></iframe>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🔊 音效测试</h2>
            
            <div class="warning-box">
                <h3>⚠️ 重要提示</h3>
                <p>在测试音效之前，请先点击游戏区域激活音频系统。现代浏览器需要用户交互才能播放音频。</p>
            </div>
            
            <div class="sound-test">
                <button class="sound-button" onclick="testSound('move')">🎵 移动音效</button>
                <button class="sound-button" onclick="testSound('rotate')">🔄 旋转音效</button>
                <button class="sound-button" onclick="testSound('lock')">🔒 锁定音效</button>
                <button class="sound-button" onclick="testSound('line')">📊 消行音效</button>
                <button class="sound-button" onclick="testSound('levelup')">⬆️ 升级音效</button>
                <button class="sound-button" onclick="testSound('gameover')">💀 游戏结束</button>
            </div>
        </div>

        <div class="section">
            <h2>📊 测试反馈</h2>
            
            <div class="info-box">
                <h3>🎯 测试重点</h3>
                <ul>
                    <li><strong>音效舒适度</strong>：是否比经典版本更柔和、更舒适？</li>
                    <li><strong>操作同步性</strong>：音效是否与操作完美同步？</li>
                    <li><strong>延迟表现</strong>：是否感觉不到明显的延迟？</li>
                    <li><strong>音效层次</strong>：不同音效是否有清晰的层次区分？</li>
                    <li><strong>长时间游戏</strong>：是否适合长时间游戏而不产生听觉疲劳？</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let audioSystem = null;
        
        // 加载游戏
        document.getElementById('loadGame').addEventListener('click', function() {
            const gameFrame = document.getElementById('gameFrame');
            const tg3Game = document.getElementById('tg3Game');
            
            tg3Game.src = './TG3/index.html';
            gameFrame.style.display = 'block';
            
            // 监听iframe加载完成
            tg3Game.onload = function() {
                console.log('TG3游戏加载完成');
                
                // 尝试获取iframe中的音频系统
                try {
                    const iframeWindow = tg3Game.contentWindow;
                    if (iframeWindow && iframeWindow.game && iframeWindow.game.audio) {
                        audioSystem = iframeWindow.game.audio;
                        console.log('音频系统获取成功');
                    }
                } catch (error) {
                    console.log('无法直接访问iframe音频系统，将通过游戏测试');
                }
            };
        });
        
        // 测试音效
        function testSound(type) {
            if (audioSystem) {
                audioSystem.playSFX(type);
                console.log(`播放${type}音效`);
            } else {
                // 如果无法直接访问音频系统，提示用户通过游戏测试
                alert(`请在游戏中测试${type}音效。\n\n操作说明：\n- 移动音效：使用方向键移动方块\n- 旋转音效：使用上方向键旋转方块\n- 锁定音效：方块落地时\n- 消行音效：消除完整行时\n- 升级音效：达到新等级时\n- 游戏结束：游戏结束时`);
            }
        }
        
        // 页面加载完成后的提示
        window.addEventListener('load', function() {
            console.log('舒适音效测试页面加载完成');
            console.log('新音效特点：');
            console.log('- 使用正弦波和三角波替代刺耳的方波');
            console.log('- 降低频率，减少听觉疲劳');
            console.log('- 更自然的音量衰减');
            console.log('- 1ms低延迟同步');
        });
    </script>
</body>
</html>
