# Xbox手柄支持 - 使用说明

## 功能概述

本游戏现已支持Xbox手柄，提供完整的游戏控制体验，包括振动反馈功能。

## 支持的手柄类型

- Xbox One 手柄
- Xbox Series X/S 手柄
- Xbox 360 手柄（部分功能）
- 其他兼容XInput的手柄

## 连接方法

1. **有线连接**：使用USB线连接手柄到电脑
2. **无线连接**：
   - 使用Xbox无线适配器
   - 通过蓝牙连接（Windows 10/11）
   - 使用USB-C线连接

## 控制映射

### 移动控制
- **左摇杆**：移动方块左右
- **十字键**：移动方块左右下
- **死区设置**：0.3（防止误触）

### 旋转控制
- **右摇杆**：旋转方块
- **X按钮**：顺时针旋转
- **Y按钮**：逆时针旋转

### 功能按钮
- **A按钮**：软降
- **Start按钮**：开始/暂停游戏
- **Back按钮**：重置游戏
- **LB/RB按钮**：音乐开关

### 键盘控制（仍然支持）
- **Enter**：开始游戏
- **←→**：移动
- **↓**：软降
- **Q/W/↑**：旋转
- **Space**：开始/暂停
- **R**：重置
- **M**：音乐开关

## 振动反馈

游戏会在以下情况触发手柄振动：

- **移动方块**：短振动（50ms）
- **旋转方块**：双短振动（30ms + 30ms）
- **软降**：中振动（100ms）
- **消除行**：模式振动（100ms + 50ms + 100ms + 50ms）
- **游戏结束**：长模式振动（200ms + 100ms + 200ms + 100ms + 200ms）

## 状态显示

游戏界面右上角会显示手柄连接状态：
- 🟢 **绿色**：手柄已连接
- 🔴 **红色**：未检测到手柄

## 测试功能

访问 `gamepad_test.html` 页面可以：
- 查看手柄连接状态
- 实时监控按钮和摇杆状态
- 测试振动功能
- 查看手柄详细信息

## 技术实现

### 使用的API
- **Web Gamepad API**：检测和读取手柄输入
- **Vibration API**：提供振动反馈
- **Gamepad Haptic Actuator API**：高级振动控制

### 兼容性
- **Chrome**：完全支持
- **Firefox**：完全支持
- **Safari**：部分支持（需要用户交互）
- **Edge**：完全支持

## 故障排除

### 手柄无法连接
1. 确保手柄已正确连接
2. 检查浏览器是否支持Gamepad API
3. 尝试刷新页面
4. 检查手柄驱动是否正确安装

### 振动不工作
1. 确保手柄支持振动功能
2. 检查浏览器权限设置
3. 某些浏览器需要HTTPS环境

### 输入延迟
1. 使用有线连接减少延迟
2. 关闭其他占用USB端口的设备
3. 检查系统性能

## 开发信息

### 文件结构
```
TG3/
├── gamepad.js          # 手柄支持核心模块
├── gamepad_test.html   # 手柄测试页面
├── tetris.js           # 主游戏逻辑（已集成手柄支持）
└── index.html          # 主游戏页面
```

### 主要类
- **GamepadManager**：手柄连接和状态管理
- **InputManager**：统一输入处理（键盘+手柄）

### 扩展功能
- 支持多手柄切换
- 可配置的按键映射
- 自定义振动模式
- 手柄配置文件保存

## 更新日志

### v1.0.0
- 初始Xbox手柄支持
- 基本控制映射
- 振动反馈系统
- 状态显示功能
- 测试页面

## 贡献

欢迎提交问题和改进建议！

---

*最后更新：2024年*
