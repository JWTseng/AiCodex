<!DOCTYPE html>
<html>
<head>
    <title>Leaderboard Deduplication Test</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #0f380f; 
            color: #00ff00; 
            padding: 20px; 
        }
        .test-btn { 
            background: #00ff00; 
            color: #0f380f; 
            border: none; 
            padding: 10px 20px; 
            margin: 10px; 
            cursor: pointer; 
        }
        .results {
            margin-top: 20px; 
            padding: 15px; 
            border: 1px solid #00ff00;
            font-size: 12px;
            line-height: 1.4;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #00ff00;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #306230;
        }
        .duplicate {
            background-color: #4a1a1a;
            text-decoration: line-through;
        }
        .kept {
            background-color: #1a4a1a;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ† æ’è¡Œæ¦œå»é‡åŠŸèƒ½æµ‹è¯•</h1>
    
    <button class="test-btn" onclick="runBasicTest()">åŸºç¡€å»é‡æµ‹è¯•</button>
    <button class="test-btn" onclick="runEdgeCaseTest()">è¾¹ç•Œæƒ…å†µæµ‹è¯•</button>
    <button class="test-btn" onclick="runPerformanceTest()">æ€§èƒ½æµ‹è¯•</button>
    <button class="test-btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    
    <div id="results" class="results">
        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
    </div>
    
    <script src="src/js/leaderboard.js"></script>
    <script>
        // ç­‰å¾…æ’è¡Œæ¦œå®ä¾‹åŒ–
        setTimeout(() => {
            if (window.tetrisWorldLeaderboard) {
                console.log('âœ… æ’è¡Œæ¦œå®ä¾‹å·²å‡†å¤‡å°±ç»ª');
            } else {
                console.error('âŒ æ’è¡Œæ¦œå®ä¾‹æœªæ‰¾åˆ°');
            }
        }, 100);

        function clearResults() {
            document.getElementById('results').innerHTML = '<p>ç»“æœå·²æ¸…é™¤</p>';
        }

        function displayResults(title, original, deduplicated) {
            const results = document.getElementById('results');
            
            const originalTable = createTable(original, 'original');
            const deduplicatedTable = createTable(deduplicated, 'deduplicated');
            
            results.innerHTML = `
                <h3>${title}</h3>
                <h4>åŸå§‹æ•°æ® (${original.length} æ¡è®°å½•):</h4>
                ${originalTable}
                <h4>å»é‡å (${deduplicated.length} æ¡è®°å½•):</h4>
                ${deduplicatedTable}
                <h4>ç»Ÿè®¡ä¿¡æ¯:</h4>
                <p>â€¢ ç§»é™¤é‡å¤è®°å½•: ${original.length - deduplicated.length} æ¡</p>
                <p>â€¢ å»é‡ç‡: ${((original.length - deduplicated.length) / original.length * 100).toFixed(1)}%</p>
            `;
        }

        function createTable(data, type) {
            if (!data || data.length === 0) {
                return '<p>æ— æ•°æ®</p>';
            }

            let html = `
                <table>
                    <tr>
                        <th>æ’å</th>
                        <th>ç©å®¶</th>
                        <th>åˆ†æ•°</th>
                        <th>ç­‰çº§</th>
                        <th>è¡Œæ•°</th>
                        <th>æ—¶é—´</th>
                    </tr>
            `;

            data.forEach((score, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${score.name || '(ç©º)'}</td>
                        <td>${score.score}</td>
                        <td>${score.level}</td>
                        <td>${score.lines}</td>
                        <td>${score.duration}s</td>
                    </tr>
                `;
            });

            html += '</table>';
            return html;
        }

        function runBasicTest() {
            if (!window.tetrisWorldLeaderboard) {
                document.getElementById('results').innerHTML = 'âŒ æ’è¡Œæ¦œå®ä¾‹æœªå‡†å¤‡å°±ç»ª';
                return;
            }

            console.log('ğŸ§ª è¿è¡ŒåŸºç¡€å»é‡æµ‹è¯•...');
            
            const testData = [
                { name: 'Alice', score: 15000, level: 5, lines: 45, duration: 180 },
                { name: 'alice', score: 12000, level: 4, lines: 35, duration: 150 }, // åŒåå°å†™ï¼Œä½åˆ†
                { name: 'Bob', score: 20000, level: 7, lines: 60, duration: 250 },
                { name: 'Alice ', score: 18000, level: 6, lines: 50, duration: 200 }, // åŒåå¸¦ç©ºæ ¼ï¼Œæ›´é«˜åˆ†
                { name: 'Charlie', score: 10000, level: 3, lines: 25, duration: 120 },
                { name: 'BOB', score: 20000, level: 7, lines: 60, duration: 250 }, // åŒåå¤§å†™ï¼Œç›¸åŒåˆ†æ•°
                { name: 'David', score: 25000, level: 8, lines: 70, duration: 300 },
            ];

            const result = window.tetrisWorldLeaderboard.deduplicateScores(testData);
            displayResults('ğŸ” åŸºç¡€å»é‡æµ‹è¯•', testData, result);
        }

        function runEdgeCaseTest() {
            if (!window.tetrisWorldLeaderboard) {
                document.getElementById('results').innerHTML = 'âŒ æ’è¡Œæ¦œå®ä¾‹æœªå‡†å¤‡å°±ç»ª';
                return;
            }

            console.log('ğŸ§ª è¿è¡Œè¾¹ç•Œæƒ…å†µæµ‹è¯•...');
            
            const testData = [
                { name: '', score: 30000, level: 9, lines: 80, duration: 350 }, // ç©ºåç§°
                { name: '   ', score: 25000, level: 8, lines: 70, duration: 300 }, // åªæœ‰ç©ºæ ¼
                { name: 'Test', score: 0, level: 0, lines: 0, duration: 0 }, // é›¶åˆ†
                { name: 'TEST', score: 0, level: 0, lines: 0, duration: 0 }, // åŒåé›¶åˆ†
                { name: 'ä¸­æ–‡å', score: 12000, level: 4, lines: 35, duration: 150 },
                { name: 'ä¸­æ–‡å', score: 15000, level: 5, lines: 45, duration: 180 }, // ä¸­æ–‡é‡å¤
                { name: 'VeryLongPlayerNameThatExceedsNormalLimits', score: 8000, level: 3, lines: 20, duration: 100 },
            ];

            const result = window.tetrisWorldLeaderboard.deduplicateScores(testData);
            displayResults('ğŸ” è¾¹ç•Œæƒ…å†µæµ‹è¯•', testData, result);
        }

        function runPerformanceTest() {
            if (!window.tetrisWorldLeaderboard) {
                document.getElementById('results').innerHTML = 'âŒ æ’è¡Œæ¦œå®ä¾‹æœªå‡†å¤‡å°±ç»ª';
                return;
            }

            console.log('ğŸ§ª è¿è¡Œæ€§èƒ½æµ‹è¯•...');
            
            // ç”Ÿæˆå¤§é‡æµ‹è¯•æ•°æ®
            const testData = [];
            const names = ['Alice', 'Bob', 'Charlie', 'David', 'Eve', 'Frank', 'Grace', 'Henry'];
            
            for (let i = 0; i < 1000; i++) {
                const name = names[Math.floor(Math.random() * names.length)];
                const variation = Math.random() < 0.3 ? name.toLowerCase() : 
                                  Math.random() < 0.1 ? name + ' ' : name;
                
                testData.push({
                    name: variation,
                    score: Math.floor(Math.random() * 50000),
                    level: Math.floor(Math.random() * 10) + 1,
                    lines: Math.floor(Math.random() * 100),
                    duration: Math.floor(Math.random() * 600) + 60
                });
            }

            const startTime = performance.now();
            const result = window.tetrisWorldLeaderboard.deduplicateScores(testData);
            const endTime = performance.now();

            document.getElementById('results').innerHTML = `
                <h3>âš¡ æ€§èƒ½æµ‹è¯•ç»“æœ</h3>
                <p>â€¢ åŸå§‹è®°å½•æ•°: ${testData.length}</p>
                <p>â€¢ å»é‡åè®°å½•æ•°: ${result.length}</p>
                <p>â€¢ ç§»é™¤é‡å¤: ${testData.length - result.length} æ¡</p>
                <p>â€¢ å¤„ç†æ—¶é—´: ${(endTime - startTime).toFixed(2)} ms</p>
                <p>â€¢ å¤„ç†é€Ÿåº¦: ${(testData.length / (endTime - startTime) * 1000).toFixed(0)} æ¡/ç§’</p>
            `;

            console.log(`ğŸ“Š æ€§èƒ½æµ‹è¯•å®Œæˆ: ${testData.length} â†’ ${result.length}, è€—æ—¶ ${(endTime - startTime).toFixed(2)}ms`);
        }
    </script>
</body>
</html>