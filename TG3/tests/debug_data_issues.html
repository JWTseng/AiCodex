<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®é—®é¢˜è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        button {
            background-color: #4285f4;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #3367d6;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #4285f4;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background-color: #e8f5e8;
            border-left-color: #4caf50;
        }
        .error {
            background-color: #ffebee;
            border-left-color: #f44336;
        }
        .warning {
            background-color: #fff3e0;
            border-left-color: #ff9800;
        }
        .info {
            background-color: #e3f2fd;
            border-left-color: #2196f3;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .browser-info {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ•°æ®é—®é¢˜è°ƒè¯•å·¥å…·</h1>
        
        <div class="browser-info">
            <h3>ğŸŒ æµè§ˆå™¨ä¿¡æ¯</h3>
            <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
            <p><strong>æµè§ˆå™¨ç±»å‹:</strong> <span id="browserType"></span></p>
            <p><strong>Web Audio APIæ”¯æŒ:</strong> <span id="audioSupport"></span></p>
            <p><strong>AudioContextæ”¯æŒ:</strong> <span id="audioContextSupport"></span></p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”Š SafariéŸ³é¢‘é—®é¢˜è°ƒè¯•</h2>
            <button onclick="testSafariAudio()">æµ‹è¯•SafariéŸ³é¢‘å…¼å®¹æ€§</button>
            <button onclick="testAudioContext()">æµ‹è¯•AudioContextçŠ¶æ€</button>
            <button onclick="testUserInteraction()">æµ‹è¯•ç”¨æˆ·äº¤äº’æ£€æµ‹</button>
            <button onclick="testAudioInitialization()">æµ‹è¯•éŸ³é¢‘åˆå§‹åŒ–</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š ä¸–ç•Œæ¦œå•æ•°æ®é—®é¢˜è°ƒè¯•</h2>
            <button onclick="testGoogleSheetsQuery()">æµ‹è¯•Google SheetsæŸ¥è¯¢</button>
            <button onclick="testScoreSubmission()">æµ‹è¯•æˆç»©æäº¤</button>
            <button onclick="testFormData()">æµ‹è¯•è¡¨å•æ•°æ®æ ¼å¼</button>
            <button onclick="checkLocalStorage()">æ£€æŸ¥æœ¬åœ°å­˜å‚¨</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ” ç»¼åˆè¯Šæ–­</h2>
            <button onclick="runFullDiagnostic()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
            <button onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
        </div>
        
        <div id="result" class="result info" style="display: none;">
            <h3>è°ƒè¯•ç»“æœ:</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <!-- åŠ è½½éŸ³é¢‘ç®¡ç†å™¨ -->
    <script src="../src/js/audio_manager.js"></script>

    <script>
        // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
        function displayBrowserInfo() {
            const userAgent = navigator.userAgent;
            document.getElementById('userAgent').textContent = userAgent;
            
            let browserType = 'Unknown';
            if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
                browserType = 'Safari';
            } else if (userAgent.includes('Chrome')) {
                browserType = 'Chrome';
            } else if (userAgent.includes('Firefox')) {
                browserType = 'Firefox';
            } else if (userAgent.includes('Edge')) {
                browserType = 'Edge';
            }
            document.getElementById('browserType').textContent = browserType;
            
            const audioSupport = typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined';
            document.getElementById('audioSupport').textContent = audioSupport ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ';
            
            const audioContextSupport = typeof AudioContext !== 'undefined' ? 'AudioContext' : 
                                      typeof webkitAudioContext !== 'undefined' ? 'webkitAudioContext' : 'âŒ ä¸æ”¯æŒ';
            document.getElementById('audioContextSupport').textContent = audioContextSupport;
        }
        
        // æµ‹è¯•SafariéŸ³é¢‘å…¼å®¹æ€§
        async function testSafariAudio() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æµ‹è¯•SafariéŸ³é¢‘å…¼å®¹æ€§...\n';
            
            try {
                const isSafari = navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome');
                resultContent.innerHTML += `æµè§ˆå™¨æ£€æµ‹: ${isSafari ? 'Safari' : 'éSafari'}\n`;
                
                // æµ‹è¯•AudioContextåˆ›å»º
                const audioContextOptions = { latencyHint: 'interactive' };
                if (!isSafari) {
                    audioContextOptions.sampleRate = 48000;
                }
                
                resultContent.innerHTML += `AudioContexté€‰é¡¹: ${JSON.stringify(audioContextOptions)}\n`;
                
                const audioContext = new (window.AudioContext || window.webkitAudioContext)(audioContextOptions);
                resultContent.innerHTML += `AudioContextåˆ›å»ºæˆåŠŸï¼ŒçŠ¶æ€: ${audioContext.state}\n`;
                
                // æµ‹è¯•éŸ³é¢‘èŠ‚ç‚¹åˆ›å»º
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                resultContent.innerHTML += `éŸ³é¢‘èŠ‚ç‚¹åˆ›å»ºæˆåŠŸ\n`;
                
                // æµ‹è¯•è¿æ¥
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                resultContent.innerHTML += `éŸ³é¢‘èŠ‚ç‚¹è¿æ¥æˆåŠŸ\n`;
                
                resultDiv.className = 'result success';
                resultContent.innerHTML += 'âœ… SafariéŸ³é¢‘å…¼å®¹æ€§æµ‹è¯•é€šè¿‡\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ SafariéŸ³é¢‘å…¼å®¹æ€§æµ‹è¯•å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æµ‹è¯•AudioContextçŠ¶æ€
        async function testAudioContext() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æµ‹è¯•AudioContextçŠ¶æ€...\n';
            
            try {
                if (!window.globalAudioManager) {
                    throw new Error('å…¨å±€éŸ³é¢‘ç®¡ç†å™¨æœªåˆ›å»º');
                }
                
                const status = window.globalAudioManager.getAudioStatus();
                resultContent.innerHTML += `éŸ³é¢‘çŠ¶æ€: ${JSON.stringify(status, null, 2)}\n`;
                
                const audioReady = await window.globalAudioManager.ensureAudioReady();
                resultContent.innerHTML += `éŸ³é¢‘ç³»ç»Ÿå°±ç»ª: ${audioReady}\n`;
                
                resultDiv.className = audioReady ? 'result success' : 'result warning';
                resultContent.innerHTML += audioReady ? 'âœ… AudioContextçŠ¶æ€æ­£å¸¸\n' : 'âš ï¸ AudioContextçŠ¶æ€å¼‚å¸¸\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ AudioContextçŠ¶æ€æµ‹è¯•å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æµ‹è¯•ç”¨æˆ·äº¤äº’æ£€æµ‹
        function testUserInteraction() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æµ‹è¯•ç”¨æˆ·äº¤äº’æ£€æµ‹...\n';
            
            try {
                if (!window.globalAudioManager) {
                    throw new Error('å…¨å±€éŸ³é¢‘ç®¡ç†å™¨æœªåˆ›å»º');
                }
                
                const status = window.globalAudioManager.getAudioStatus();
                resultContent.innerHTML += `ç”¨æˆ·äº¤äº’çŠ¶æ€: ${status.userInteracted}\n`;
                
                // æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’
                document.body.click();
                
                setTimeout(() => {
                    const newStatus = window.globalAudioManager.getAudioStatus();
                    resultContent.innerHTML += `æ¨¡æ‹Ÿäº¤äº’åçŠ¶æ€: ${newStatus.userInteracted}\n`;
                    
                    resultDiv.className = 'result success';
                    resultContent.innerHTML += 'âœ… ç”¨æˆ·äº¤äº’æ£€æµ‹æ­£å¸¸\n';
                }, 100);
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ ç”¨æˆ·äº¤äº’æ£€æµ‹å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æµ‹è¯•éŸ³é¢‘åˆå§‹åŒ–
        async function testAudioInitialization() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æµ‹è¯•éŸ³é¢‘åˆå§‹åŒ–...\n';
            
            try {
                if (!window.globalAudioManager) {
                    throw new Error('å…¨å±€éŸ³é¢‘ç®¡ç†å™¨æœªåˆ›å»º');
                }
                
                await window.globalAudioManager.initializeAudio();
                
                const status = window.globalAudioManager.getAudioStatus();
                resultContent.innerHTML += `åˆå§‹åŒ–åçŠ¶æ€: ${JSON.stringify(status, null, 2)}\n`;
                
                resultDiv.className = 'result success';
                resultContent.innerHTML += 'âœ… éŸ³é¢‘åˆå§‹åŒ–æˆåŠŸ\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æµ‹è¯•Google SheetsæŸ¥è¯¢
        async function testGoogleSheetsQuery() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æµ‹è¯•Google SheetsæŸ¥è¯¢...\n';
            
            try {
                const SPREADSHEET_ID = '17Wu8sonn4kxHX3VWT1ZKPR3M-ZDSUWy8UeKG1SvdFoU';
                const SHEET_NAME = 'scores_raw';
                
                const query = encodeURIComponent(`
                    SELECT player_name, score, level, lines, duration_ms 
                    FROM ${SHEET_NAME} 
                    ORDER BY score DESC 
                    LIMIT 10
                `);
                
                const googleUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tq=${query}&tqx=out:json`;
                const proxyUrl = `http://localhost:8002/proxy/sheets?url=${encodeURIComponent(googleUrl)}`;
                resultContent.innerHTML += `åŸå§‹URL: ${googleUrl}\n`;
                resultContent.innerHTML += `ä»£ç†URL: ${proxyUrl}\n`;
                
                const response = await fetch(proxyUrl, {
                    method: 'GET',
                    mode: 'cors'
                });
                const text = await response.text();
                
                resultContent.innerHTML += `å“åº”çŠ¶æ€: ${response.status}\n`;
                resultContent.innerHTML += `å“åº”é•¿åº¦: ${text.length}\n`;
                resultContent.innerHTML += `å“åº”å‰200å­—ç¬¦: ${text.substring(0, 200)}\n`;
                
                const jsonText = text.substring(47).slice(0, -2);
                const data = JSON.parse(jsonText);
                
                resultContent.innerHTML += `è§£æåæ•°æ®: ${JSON.stringify(data, null, 2)}\n`;
                
                if (data.table && data.table.rows) {
                    resultContent.innerHTML += `æ‰¾åˆ° ${data.table.rows.length} æ¡è®°å½•\n`;
                    resultDiv.className = 'result success';
                } else {
                    resultContent.innerHTML += 'æœªæ‰¾åˆ°æ•°æ®\n';
                    resultDiv.className = 'result warning';
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ Google SheetsæŸ¥è¯¢å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æµ‹è¯•æˆç»©æäº¤
        async function testScoreSubmission() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æµ‹è¯•æˆç»©æäº¤...\n';
            
            try {
                // æ¨¡æ‹Ÿæˆç»©æ•°æ®
                const testScore = {
                    score: 1000,
                    level: 1,
                    lines: 4,
                    duration: 60000,
                    playerName: 'TestPlayer'
                };
                
                resultContent.innerHTML += `æµ‹è¯•æˆç»©: ${JSON.stringify(testScore, null, 2)}\n`;
                
                // æ£€æŸ¥ScoreSubmissionManageræ˜¯å¦å­˜åœ¨
                if (!window.scoreSubmissionManager) {
                    throw new Error('ScoreSubmissionManageræœªåˆ›å»º');
                }
                
                const result = await window.scoreSubmissionManager.submitScore(testScore);
                resultContent.innerHTML += `æäº¤ç»“æœ: ${JSON.stringify(result, null, 2)}\n`;
                
                resultDiv.className = result.success ? 'result success' : 'result error';
                resultContent.innerHTML += result.success ? 'âœ… æˆç»©æäº¤æˆåŠŸ\n' : 'âŒ æˆç»©æäº¤å¤±è´¥\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ æˆç»©æäº¤æµ‹è¯•å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æµ‹è¯•è¡¨å•æ•°æ®æ ¼å¼
        function testFormData() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æµ‹è¯•è¡¨å•æ•°æ®æ ¼å¼...\n';
            
            try {
                if (!window.scoreSubmissionManager) {
                    throw new Error('ScoreSubmissionManageræœªåˆ›å»º');
                }
                
                const testScore = {
                    score: 1000,
                    level: 1,
                    lines: 4,
                    duration: 60000,
                    playerName: 'TestPlayer'
                };
                
                const formData = window.scoreSubmissionManager.prepareSubmissionData(testScore);
                resultContent.innerHTML += `è¡¨å•æ•°æ®: ${JSON.stringify(formData, null, 2)}\n`;
                
                // æµ‹è¯•FormDataå¯¹è±¡
                const submitData = new FormData();
                for (const [key, value] of Object.entries(formData)) {
                    submitData.append(key, value);
                }
                
                resultContent.innerHTML += 'FormDataå¯¹è±¡åˆ›å»ºæˆåŠŸ\n';
                
                resultDiv.className = 'result success';
                resultContent.innerHTML += 'âœ… è¡¨å•æ•°æ®æ ¼å¼æ­£ç¡®\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ è¡¨å•æ•°æ®æ ¼å¼æµ‹è¯•å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
        function checkLocalStorage() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨æ£€æŸ¥æœ¬åœ°å­˜å‚¨...\n';
            
            try {
                const playerName = localStorage.getItem('playerName');
                const playerHighScore = localStorage.getItem('playerHighScore');
                const highScores = localStorage.getItem('highScores');
                
                resultContent.innerHTML += `ç©å®¶åç§°: ${playerName || 'æœªè®¾ç½®'}\n`;
                resultContent.innerHTML += `æœ€é«˜åˆ†: ${playerHighScore || 'æ— '}\n`;
                resultContent.innerHTML += `æœ¬åœ°é«˜åˆ†è®°å½•: ${highScores ? 'å­˜åœ¨' : 'æ— '}\n`;
                
                if (highScores) {
                    try {
                        const scores = JSON.parse(highScores);
                        resultContent.innerHTML += `æœ¬åœ°è®°å½•æ•°é‡: ${scores.length}\n`;
                        resultContent.innerHTML += `æœ¬åœ°è®°å½•: ${JSON.stringify(scores, null, 2)}\n`;
                    } catch (e) {
                        resultContent.innerHTML += `æœ¬åœ°è®°å½•è§£æå¤±è´¥: ${e.message}\n`;
                    }
                }
                
                resultDiv.className = 'result success';
                resultContent.innerHTML += 'âœ… æœ¬åœ°å­˜å‚¨æ£€æŸ¥å®Œæˆ\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ æœ¬åœ°å­˜å‚¨æ£€æŸ¥å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // è¿è¡Œå®Œæ•´è¯Šæ–­
        async function runFullDiagnostic() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultContent.innerHTML = 'æ­£åœ¨è¿è¡Œå®Œæ•´è¯Šæ–­...\n';
            
            try {
                // 1. æµè§ˆå™¨ä¿¡æ¯
                resultContent.innerHTML += '=== æµè§ˆå™¨ä¿¡æ¯ ===\n';
                const userAgent = navigator.userAgent;
                const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
                resultContent.innerHTML += `æµè§ˆå™¨: ${isSafari ? 'Safari' : 'éSafari'}\n`;
                resultContent.innerHTML += `Web Audio API: ${typeof AudioContext !== 'undefined' ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}\n`;
                
                // 2. éŸ³é¢‘ç³»ç»Ÿ
                resultContent.innerHTML += '\n=== éŸ³é¢‘ç³»ç»Ÿ ===\n';
                if (window.globalAudioManager) {
                    const audioStatus = window.globalAudioManager.getAudioStatus();
                    resultContent.innerHTML += `éŸ³é¢‘ç®¡ç†å™¨: å·²åˆ›å»º\n`;
                    resultContent.innerHTML += `åˆå§‹åŒ–çŠ¶æ€: ${audioStatus.isInitialized}\n`;
                    resultContent.innerHTML += `ç”¨æˆ·äº¤äº’: ${audioStatus.userInteracted}\n`;
                    resultContent.innerHTML += `AudioContextçŠ¶æ€: ${audioStatus.audioContextState}\n`;
                } else {
                    resultContent.innerHTML += `éŸ³é¢‘ç®¡ç†å™¨: æœªåˆ›å»º\n`;
                }
                
                // 3. æˆç»©æäº¤ç³»ç»Ÿ
                resultContent.innerHTML += '\n=== æˆç»©æäº¤ç³»ç»Ÿ ===\n';
                if (window.scoreSubmissionManager) {
                    resultContent.innerHTML += `æˆç»©æäº¤ç®¡ç†å™¨: å·²åˆ›å»º\n`;
                } else {
                    resultContent.innerHTML += `æˆç»©æäº¤ç®¡ç†å™¨: æœªåˆ›å»º\n`;
                }
                
                // 4. æ’è¡Œæ¦œç³»ç»Ÿ
                resultContent.innerHTML += '\n=== æ’è¡Œæ¦œç³»ç»Ÿ ===\n';
                if (window.tetrisWorldLeaderboard) {
                    resultContent.innerHTML += `æ’è¡Œæ¦œç®¡ç†å™¨: å·²åˆ›å»º\n`;
                } else {
                    resultContent.innerHTML += `æ’è¡Œæ¦œç®¡ç†å™¨: æœªåˆ›å»º\n`;
                }
                
                // 5. æœ¬åœ°å­˜å‚¨
                resultContent.innerHTML += '\n=== æœ¬åœ°å­˜å‚¨ ===\n';
                const playerName = localStorage.getItem('playerName');
                const playerHighScore = localStorage.getItem('playerHighScore');
                resultContent.innerHTML += `ç©å®¶åç§°: ${playerName || 'æœªè®¾ç½®'}\n`;
                resultContent.innerHTML += `æœ€é«˜åˆ†: ${playerHighScore || 'æ— '}\n`;
                
                resultDiv.className = 'result success';
                resultContent.innerHTML += '\nâœ… å®Œæ•´è¯Šæ–­å®Œæˆ\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ å®Œæ•´è¯Šæ–­å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result warning';
            resultContent.innerHTML = 'æ­£åœ¨æ¸…é™¤æ‰€æœ‰æ•°æ®...\n';
            
            try {
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨
                localStorage.clear();
                resultContent.innerHTML += 'æœ¬åœ°å­˜å‚¨å·²æ¸…é™¤\n';
                
                // é‡ç½®éŸ³é¢‘ç®¡ç†å™¨
                if (window.globalAudioManager) {
                    window.globalAudioManager.reset();
                    resultContent.innerHTML += 'éŸ³é¢‘ç®¡ç†å™¨å·²é‡ç½®\n';
                }
                
                resultDiv.className = 'result success';
                resultContent.innerHTML += 'âœ… æ‰€æœ‰æ•°æ®å·²æ¸…é™¤\n';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultContent.innerHTML += `âŒ æ•°æ®æ¸…é™¤å¤±è´¥: ${error.message}\n`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ•°æ®é—®é¢˜è°ƒè¯•å·¥å…·å·²åŠ è½½');
            displayBrowserInfo();
        });
    </script>
</body>
</html>
