<!DOCTYPE html>
<html>
<head>
    <title>Keyboard Controls Test</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #0f380f; 
            color: #00ff00; 
            padding: 20px; 
        }
        .test-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 1200px;
        }
        .control-section {
            border: 2px solid #00ff00;
            padding: 20px;
            background: #1a4a1a;
        }
        .key-state {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            margin: 4px 0;
            border: 1px solid #306230;
            background: #0f380f;
        }
        .key-state.active {
            background: #4a6a4a;
            border-color: #8bac0f;
            color: #ffffff;
            font-weight: bold;
        }
        .instructions {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #8bac0f;
            background: #1a4a1a;
        }
        .key-combo {
            color: #ffd700;
            font-weight: bold;
        }
        .legend {
            font-size: 12px;
            color: #8bac0f;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ® é”®ç›˜æ§åˆ¶æµ‹è¯• - æ–¹æ¡ˆAç°ä»£ç«æŠ€æ ‡å‡†</h1>
    
    <div class="instructions">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <p>æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ä»»æ„é”®ï¼Œè§‚å¯Ÿå³ä¾§çŠ¶æ€å˜åŒ–ã€‚ç»¿è‰²é«˜äº®è¡¨ç¤ºæŒ‰é”®è¢«æ£€æµ‹åˆ°ã€‚</p>
        <p class="legend">
            <strong>ä¸»è¦é”®ä½:</strong> 
            <span class="key-combo">A/D</span> ç§»åŠ¨, 
            <span class="key-combo">Q/E</span> æ—‹è½¬, 
            <span class="key-combo">S</span> è½¯é™, 
            <span class="key-combo">Space</span> ç¡¬é™, 
            <span class="key-combo">P</span> æš‚åœ<br>
            <strong>å…¼å®¹é”®ä½:</strong> æ–¹å‘é”®ä»ç„¶å¯ç”¨ä½œå¤‡é€‰
        </p>
    </div>
    
    <div class="test-container">
        <div class="control-section">
            <h3>ğŸ¯ ä¸»è¦æ§åˆ¶ (æ˜¾ç¤ºåœ¨æ¸¸æˆä¸­)</h3>
            <div class="key-state" id="move-left">
                <span>A - å‘å·¦ç§»åŠ¨</span>
                <span id="left-status">â—</span>
            </div>
            <div class="key-state" id="move-right">
                <span>D - å‘å³ç§»åŠ¨</span>
                <span id="right-status">â—</span>
            </div>
            <div class="key-state" id="rotate-ccw">
                <span>Q - é€†æ—¶é’ˆæ—‹è½¬</span>
                <span id="rotateCCW-status">â—</span>
            </div>
            <div class="key-state" id="rotate-cw">
                <span>E - é¡ºæ—¶é’ˆæ—‹è½¬</span>
                <span id="rotateCW-status">â—</span>
            </div>
            <div class="key-state" id="soft-drop">
                <span>S - è½¯é™</span>
                <span id="down-status">â—</span>
            </div>
            <div class="key-state" id="hard-drop">
                <span>Space - ç¡¬é™</span>
                <span id="hardDrop-status">â—</span>
            </div>
            <div class="key-state" id="pause">
                <span>P - æš‚åœ</span>
                <span id="pause-status">â—</span>
            </div>
        </div>
        
        <div class="control-section">
            <h3>ğŸ”„ å…¼å®¹æ§åˆ¶ (å¤‡é€‰é”®ä½)</h3>
            <div class="key-state" id="arrow-left">
                <span>â† - å‘å·¦ç§»åŠ¨</span>
                <span id="arrow-left-status">â—</span>
            </div>
            <div class="key-state" id="arrow-right">
                <span>â†’ - å‘å³ç§»åŠ¨</span>
                <span id="arrow-right-status">â—</span>
            </div>
            <div class="key-state" id="arrow-down">
                <span>â†“ - è½¯é™</span>
                <span id="arrow-down-status">â—</span>
            </div>
            <div class="key-state" id="arrow-up">
                <span>â†‘ - é¡ºæ—¶é’ˆæ—‹è½¬</span>
                <span id="arrow-up-status">â—</span>
            </div>
            <div class="key-state" id="escape">
                <span>Esc - æš‚åœ</span>
                <span id="escape-status">â—</span>
            </div>
            
            <h3 style="margin-top: 20px;">âš™ï¸ é¢å¤–åŠŸèƒ½</h3>
            <div class="key-state" id="reset">
                <span>R - é‡ç½®</span>
                <span id="reset-status">â—</span>
            </div>
            <div class="key-state" id="music">
                <span>M - éŸ³ä¹åˆ‡æ¢</span>
                <span id="musicToggle-status">â—</span>
            </div>
        </div>
    </div>
    
    <script src="src/js/input/keyboard_controller.js"></script>
    <script>
        // åˆ›å»ºé”®ç›˜æ§åˆ¶å™¨å®ä¾‹
        const keyboard = new KeyboardController();
        
        // çŠ¶æ€æ˜ å°„
        const statusMap = {
            'left': ['left-status', 'arrow-left-status'],
            'right': ['right-status', 'arrow-right-status'],
            'down': ['down-status', 'arrow-down-status'],
            'rotateCCW': ['rotateCCW-status'],
            'rotateCW': ['rotateCW-status', 'arrow-up-status'],
            'pause': ['pause-status', 'escape-status'],
            'hardDrop': ['hardDrop-status'],
            'reset': ['reset-status'],
            'musicToggle': ['musicToggle-status']
        };
        
        // å…ƒç´ æ˜ å°„
        const elementMap = {
            'left': ['move-left', 'arrow-left'],
            'right': ['move-right', 'arrow-right'],
            'down': ['soft-drop', 'arrow-down'],
            'rotateCCW': ['rotate-ccw'],
            'rotateCW': ['rotate-cw', 'arrow-up'],
            'pause': ['pause', 'escape'],
            'hardDrop': ['hard-drop'],
            'reset': ['reset'],
            'musicToggle': ['music']
        };
        
        // å®æ—¶æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateDisplay() {
            const state = keyboard.getState();
            
            Object.keys(statusMap).forEach(key => {
                const isActive = state[key];
                const statusIds = statusMap[key];
                const elementIds = elementMap[key];
                
                // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
                statusIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = isActive ? 'ğŸŸ¢' : 'â—';
                    }
                });
                
                // æ›´æ–°å…ƒç´ æ ·å¼
                elementIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.classList.toggle('active', isActive);
                    }
                });
            });
            
            requestAnimationFrame(updateDisplay);
        }
        
        // å¼€å§‹æ›´æ–°å¾ªç¯
        updateDisplay();
        
        // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬å™¨
        let keyPressCount = 0;
        document.addEventListener('keydown', (e) => {
            keyPressCount++;
            console.log(`é”®ä½æµ‹è¯• #${keyPressCount}: ${e.code} (${e.key})`);
        });
        
        // æ˜¾ç¤ºå®æ—¶çŠ¶æ€
        const statusDiv = document.createElement('div');
        statusDiv.style.cssText = `
            position: fixed; top: 10px; right: 10px; 
            background: rgba(15, 56, 15, 0.9); 
            padding: 10px; border: 1px solid #00ff00;
            font-size: 12px; max-width: 200px;
        `;
        statusDiv.innerHTML = '<strong>å®æ—¶çŠ¶æ€:</strong><div id="real-time-status"></div>';
        document.body.appendChild(statusDiv);
        
        function updateRealTimeStatus() {
            const state = keyboard.getState();
            const activeKeys = Object.keys(state).filter(key => state[key]);
            document.getElementById('real-time-status').innerHTML = 
                activeKeys.length > 0 ? activeKeys.join(', ') : 'æ— æŒ‰é”®';
            requestAnimationFrame(updateRealTimeStatus);
        }
        updateRealTimeStatus();
    </script>
</body>
</html>