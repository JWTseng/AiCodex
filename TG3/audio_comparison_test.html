<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘å¯¹æ¯”æµ‹è¯• - çº¿ä¸Šç‰ˆæœ¬ vs å½“å‰ç‰ˆæœ¬</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0f380f;
            color: #8bac0f;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #306230;
            border: 2px solid #8bac0f;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        .test-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ffffff;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-item {
            background: #0f380f;
            border: 1px solid #8bac0f;
            padding: 15px;
            border-radius: 5px;
        }
        .test-item h3 {
            margin: 0 0 10px 0;
            color: #ffffff;
        }
        .test-button {
            background: #8bac0f;
            color: #0f380f;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
        }
        .test-button:hover {
            background: #9bbc0f;
        }
        .test-button:disabled {
            background: #306230;
            color: #8bac0f;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #0f380f;
            color: #8bac0f;
            border: 1px solid #8bac0f;
        }
        .status.error {
            background: #380f0f;
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
        }
        .status.info {
            background: #0f0f38;
            color: #6b6bff;
            border: 1px solid #6b6bff;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #8bac0f;
            padding: 8px;
            text-align: left;
        }
        .comparison-table th {
            background: #306230;
            color: #ffffff;
        }
        .comparison-table tr:nth-child(even) {
            background: #0f380f;
        }
        .comparison-table tr:nth-child(odd) {
            background: #1a4a1a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ éŸ³é¢‘å¯¹æ¯”æµ‹è¯• - çº¿ä¸Šç‰ˆæœ¬ vs å½“å‰ç‰ˆæœ¬</h1>
        
        <div class="test-section">
            <div class="test-title">ğŸ“Š éŸ³é¢‘å‚æ•°å¯¹æ¯”</div>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>éŸ³æ•ˆç±»å‹</th>
                        <th>çº¿ä¸Šç‰ˆæœ¬å‚æ•°</th>
                        <th>å½“å‰ç‰ˆæœ¬å‚æ•°</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ç§»åŠ¨éŸ³æ•ˆ (move)</td>
                        <td>600Hz, 80ms, æ­£å¼¦æ³¢, å¿«é€Ÿè¡°å‡</td>
                        <td>600Hz, 50ms, åŸºç¡€è¡°å‡</td>
                        <td id="move-status">å¾…æµ‹è¯•</td>
                    </tr>
                    <tr>
                        <td>æ—‹è½¬éŸ³æ•ˆ (rotate)</td>
                        <td>800Hz, 100ms, ä¸‰è§’æ³¢, ç²¾ç¡®è¡°å‡</td>
                        <td>800Hz, 80ms, åŸºç¡€è¡°å‡</td>
                        <td id="rotate-status">å¾…æµ‹è¯•</td>
                    </tr>
                    <tr>
                        <td>é”å®šéŸ³æ•ˆ (lock)</td>
                        <td>200Hz, 150ms, æ­£å¼¦æ³¢, è‡ªç„¶è¡°å‡</td>
                        <td>200Hz, 150ms, åŸºç¡€è¡°å‡</td>
                        <td id="lock-status">å¾…æµ‹è¯•</td>
                    </tr>
                    <tr>
                        <td>æ¶ˆè¡ŒéŸ³æ•ˆ (line)</td>
                        <td>1000Hzâ†’1500Hz, 200ms, æ­£å¼¦æ³¢, é¢‘ç‡ä¸Šå‡</td>
                        <td>1000Hzâ†’1500Hz, 200ms, æ­£å¼¦æ³¢, é¢‘ç‡ä¸Šå‡</td>
                        <td id="line-status">å¾…æµ‹è¯•</td>
                    </tr>
                    <tr>
                        <td>å‡çº§éŸ³æ•ˆ (levelup)</td>
                        <td>500Hzâ†’1200Hz, 500ms, æ­£å¼¦æ³¢, é¢‘ç‡ä¸Šå‡</td>
                        <td>500Hzâ†’1200Hz, 500ms, æ­£å¼¦æ³¢, é¢‘ç‡ä¸Šå‡</td>
                        <td id="levelup-status">å¾…æµ‹è¯•</td>
                    </tr>
                    <tr>
                        <td>æ¸¸æˆç»“æŸ (gameover)</td>
                        <td>300Hzâ†’80Hz, 600ms, æ­£å¼¦æ³¢, é¢‘ç‡ä¸‹é™</td>
                        <td>300Hzâ†’80Hz, 600ms, æ­£å¼¦æ³¢, é¢‘ç‡ä¸‹é™</td>
                        <td id="gameover-status">å¾…æµ‹è¯•</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ® åŸºç¡€éŸ³æ•ˆæµ‹è¯•</div>
            <div class="test-grid">
                <div class="test-item">
                    <h3>ç§»åŠ¨éŸ³æ•ˆ</h3>
                    <button class="test-button" onclick="testSFX('move')">æ’­æ”¾ Move SFX</button>
                    <div id="move-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•ç§»åŠ¨éŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>æ—‹è½¬éŸ³æ•ˆ</h3>
                    <button class="test-button" onclick="testSFX('rotate')">æ’­æ”¾ Rotate SFX</button>
                    <div id="rotate-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ—‹è½¬éŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>é”å®šéŸ³æ•ˆ</h3>
                    <button class="test-button" onclick="testSFX('lock')">æ’­æ”¾ Lock SFX</button>
                    <div id="lock-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•é”å®šéŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>è½¯é™è½åœ°ï¼ˆsoftlockï¼‰</h3>
                    <button class="test-button" onclick="testSFX('softlock')">æ’­æ”¾ Soft Lock</button>
                    <div id="softlock-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•è½¯é™è½åœ°</div>
                </div>
                <div class="test-item">
                    <h3>ç¡¬é™è½åœ°ï¼ˆhardlockï¼‰</h3>
                    <button class="test-button" onclick="testSFX('hardlock')">æ’­æ”¾ Hard Lock</button>
                    <div id="hardlock-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•ç¡¬é™è½åœ°</div>
                </div>
                <div class="test-item">
                    <h3>æ¶ˆè¡ŒéŸ³æ•ˆ</h3>
                    <button class="test-button" onclick="testSFX('line')">æ’­æ”¾ Line SFX</button>
                    <div id="line-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ¶ˆè¡ŒéŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>å‡çº§éŸ³æ•ˆ</h3>
                    <button class="test-button" onclick="testSFX('levelup')">æ’­æ”¾ Levelup SFX</button>
                    <div id="levelup-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•å‡çº§éŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>æ¸¸æˆç»“æŸ</h3>
                    <button class="test-button" onclick="testSFX('gameover')">æ’­æ”¾ Gameover SFX</button>
                    <div id="gameover-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ¸¸æˆç»“æŸéŸ³æ•ˆ</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸµ è¿å‡»éŸ³æ•ˆæµ‹è¯•</div>
            <div class="test-grid">
                <div class="test-item">
                    <h3>è¿å‡»éŸ³æ•ˆ (2è¿å‡»)</h3>
                    <button class="test-button" onclick="testCombo(2)">æ’­æ”¾ 2x Combo</button>
                    <div id="combo2-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•2è¿å‡»éŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>è¿å‡»éŸ³æ•ˆ (5è¿å‡»)</h3>
                    <button class="test-button" onclick="testCombo(5)">æ’­æ”¾ 5x Combo</button>
                    <div id="combo5-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•5è¿å‡»éŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>è¿å‡»éŸ³æ•ˆ (8è¿å‡»)</h3>
                    <button class="test-button" onclick="testCombo(8)">æ’­æ”¾ 8x Combo</button>
                    <div id="combo8-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•8è¿å‡»éŸ³æ•ˆ</div>
                </div>
                <div class="test-item">
                    <h3>å‹å“¨"å®"å£°</h3>
                    <button class="test-button" onclick="testClutchDing()">æ’­æ”¾ Clutch Ding</button>
                    <div id="clutch-result" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•å‹å“¨"å®"å£°</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">âš¡ å»¶è¿Ÿæµ‹è¯•</div>
            <div class="test-grid">
                <div class="test-item">
                    <h3>å“åº”å»¶è¿Ÿæµ‹è¯•</h3>
                    <button class="test-button" onclick="testLatency()">å¼€å§‹å»¶è¿Ÿæµ‹è¯•</button>
                    <div id="latency-result" class="status info">ç‚¹å‡»æŒ‰é’®å¼€å§‹å»¶è¿Ÿæµ‹è¯•</div>
                </div>
                <div class="test-item">
                    <h3>è¿ç»­æ’­æ”¾æµ‹è¯•</h3>
                    <button class="test-button" onclick="testContinuous()">å¼€å§‹è¿ç»­æ’­æ”¾</button>
                    <div id="continuous-result" class="status info">ç‚¹å‡»æŒ‰é’®å¼€å§‹è¿ç»­æ’­æ”¾æµ‹è¯•</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“ˆ æµ‹è¯•ç»“æœæ€»ç»“</div>
            <div id="summary-result" class="status info">
                å®Œæˆæ‰€æœ‰æµ‹è¯•åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºè¯¦ç»†çš„å¯¹æ¯”ç»“æœå’Œå»ºè®®
            </div>
        </div>
    </div>

    <script src="audio_manager.js"></script>
    <script>
        let audioManager = null;
        let testResults = {};

        // åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨
        function initAudio() {
            if (!audioManager) {
                audioManager = new GlobalAudioManager();
                console.log('éŸ³é¢‘ç®¡ç†å™¨å·²åˆå§‹åŒ–');
            }
        }

        // æµ‹è¯•åŸºç¡€éŸ³æ•ˆ
        async function testSFX(type) {
            initAudio();
            const resultElement = document.getElementById(`${type}-result`);
            const statusElement = document.getElementById(`${type}-status`);
            
            try {
                const startTime = performance.now();
                await audioManager.playSFX(type);
                const endTime = performance.now();
                const latency = endTime - startTime;
                
                resultElement.className = 'status success';
                resultElement.textContent = `âœ… æ’­æ”¾æˆåŠŸ - å»¶è¿Ÿ: ${latency.toFixed(2)}ms`;
                
                if (statusElement) {
                    statusElement.textContent = 'âœ… å·²å¯¹é½';
                    statusElement.style.color = '#8bac0f';
                }
                
                testResults[type] = { success: true, latency };
            } catch (error) {
                resultElement.className = 'status error';
                resultElement.textContent = `âŒ æ’­æ”¾å¤±è´¥: ${error.message}`;
                
                if (statusElement) {
                    statusElement.textContent = 'âŒ æœªå¯¹é½';
                    statusElement.style.color = '#ff6b6b';
                }
                
                testResults[type] = { success: false, error: error.message };
            }
        }

        // æµ‹è¯•è¿å‡»éŸ³æ•ˆ
        function testCombo(comboCount) {
            initAudio();
            const resultElement = document.getElementById(`combo${comboCount}-result`);
            
            try {
                // æ¨¡æ‹Ÿè¿å‡»éŸ³æ•ˆç”Ÿæˆ
                const startTime = performance.now();
                generateComboSFX(comboCount);
                const endTime = performance.now();
                const latency = endTime - startTime;
                
                resultElement.className = 'status success';
                resultElement.textContent = `âœ… ${comboCount}è¿å‡»éŸ³æ•ˆæ’­æ”¾æˆåŠŸ - å»¶è¿Ÿ: ${latency.toFixed(2)}ms`;
                
                testResults[`combo${comboCount}`] = { success: true, latency };
            } catch (error) {
                resultElement.className = 'status error';
                resultElement.textContent = `âŒ ${comboCount}è¿å‡»éŸ³æ•ˆæ’­æ”¾å¤±è´¥: ${error.message}`;
                
                testResults[`combo${comboCount}`] = { success: false, error: error.message };
            }
        }

        // æµ‹è¯•å‹å“¨"å®"å£°
        function testClutchDing() {
            initAudio();
            const resultElement = document.getElementById('clutch-result');
            
            try {
                const startTime = performance.now();
                playClutchDing();
                const endTime = performance.now();
                const latency = endTime - startTime;
                
                resultElement.className = 'status success';
                resultElement.textContent = `âœ… å‹å“¨"å®"å£°æ’­æ”¾æˆåŠŸ - å»¶è¿Ÿ: ${latency.toFixed(2)}ms`;
                
                testResults.clutch = { success: true, latency };
            } catch (error) {
                resultElement.className = 'status error';
                resultElement.textContent = `âŒ å‹å“¨"å®"å£°æ’­æ”¾å¤±è´¥: ${error.message}`;
                
                testResults.clutch = { success: false, error: error.message };
            }
        }

        // æ¨¡æ‹Ÿè¿å‡»éŸ³æ•ˆç”Ÿæˆï¼ˆç®€åŒ–ç‰ˆï¼‰
        function generateComboSFX(comboCount) {
            if (!audioManager || !audioManager.audioContext) return;
            
            const ctx = audioManager.audioContext;
            const startTime = ctx.currentTime;
            
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioManager.sfxGain);
            
            // ç®€åŒ–çš„è¿å‡»éŸ³æ•ˆ
            const freq = 261.63 + (comboCount - 2) * 50;
            oscillator.frequency.setValueAtTime(freq, startTime);
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, startTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
            
            oscillator.start(startTime);
            oscillator.stop(startTime + 0.5);
        }

        // æ¨¡æ‹Ÿå‹å“¨"å®"å£°
        function playClutchDing() {
            if (!audioManager || !audioManager.audioContext) return;
            
            const ctx = audioManager.audioContext;
            const now = ctx.currentTime;
            
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(2000, now);
            
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.35, now + 0.006);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.18);
            
            osc.connect(gain).connect(audioManager.sfxGain);
            
            osc.start(now);
            osc.stop(now + 0.2);
        }

        // å»¶è¿Ÿæµ‹è¯•
        async function testLatency() {
            initAudio();
            const resultElement = document.getElementById('latency-result');
            
            const latencies = [];
            const testCount = 10;
            
            resultElement.className = 'status info';
            resultElement.textContent = 'ğŸ”„ æ­£åœ¨è¿›è¡Œå»¶è¿Ÿæµ‹è¯•...';
            
            for (let i = 0; i < testCount; i++) {
                const startTime = performance.now();
                await audioManager.playSFX('move');
                const endTime = performance.now();
                latencies.push(endTime - startTime);
                
                // ç­‰å¾…ä¸€å°æ®µæ—¶é—´
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const avgLatency = latencies.reduce((a, b) => a + b, 0) / latencies.length;
            const maxLatency = Math.max(...latencies);
            const minLatency = Math.min(...latencies);
            
            resultElement.className = 'status success';
            resultElement.textContent = `âœ… å»¶è¿Ÿæµ‹è¯•å®Œæˆ - å¹³å‡: ${avgLatency.toFixed(2)}ms, æœ€å¤§: ${maxLatency.toFixed(2)}ms, æœ€å°: ${minLatency.toFixed(2)}ms`;
            
            testResults.latency = { avgLatency, maxLatency, minLatency };
        }

        // è¿ç»­æ’­æ”¾æµ‹è¯•
        async function testContinuous() {
            initAudio();
            const resultElement = document.getElementById('continuous-result');
            
            resultElement.className = 'status info';
            resultElement.textContent = 'ğŸ”„ æ­£åœ¨è¿›è¡Œè¿ç»­æ’­æ”¾æµ‹è¯•...';
            
            const sfxTypes = ['move', 'rotate', 'lock', 'line'];
            let successCount = 0;
            let totalCount = 20;
            
            for (let i = 0; i < totalCount; i++) {
                try {
                    const type = sfxTypes[i % sfxTypes.length];
                    await audioManager.playSFX(type);
                    successCount++;
                } catch (error) {
                    console.error('è¿ç»­æ’­æ”¾æµ‹è¯•å¤±è´¥:', error);
                }
                
                // çŸ­æš‚ç­‰å¾…
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            const successRate = (successCount / totalCount) * 100;
            
            resultElement.className = successRate >= 95 ? 'status success' : 'status error';
            resultElement.textContent = `âœ… è¿ç»­æ’­æ”¾æµ‹è¯•å®Œæˆ - æˆåŠŸç‡: ${successRate.toFixed(1)}% (${successCount}/${totalCount})`;
            
            testResults.continuous = { successRate, successCount, totalCount };
        }

        // ç”Ÿæˆæµ‹è¯•æ€»ç»“
        function generateSummary() {
            const summaryElement = document.getElementById('summary-result');
            
            const totalTests = Object.keys(testResults).length;
            const successfulTests = Object.values(testResults).filter(r => r.success !== false).length;
            const successRate = totalTests > 0 ? (successfulTests / totalTests) * 100 : 0;
            
            let summary = `ğŸ“Š æµ‹è¯•æ€»ç»“ - æ€»æµ‹è¯•: ${totalTests}, æˆåŠŸ: ${successfulTests}, æˆåŠŸç‡: ${successRate.toFixed(1)}%\n\n`;
            
            // å»¶è¿Ÿåˆ†æ
            if (testResults.latency) {
                const { avgLatency, maxLatency, minLatency } = testResults.latency;
                summary += `âš¡ å»¶è¿Ÿæ€§èƒ½:\n`;
                summary += `   - å¹³å‡å»¶è¿Ÿ: ${avgLatency.toFixed(2)}ms\n`;
                summary += `   - æœ€å¤§å»¶è¿Ÿ: ${maxLatency.toFixed(2)}ms\n`;
                summary += `   - æœ€å°å»¶è¿Ÿ: ${minLatency.toFixed(2)}ms\n`;
                
                if (avgLatency < 10) {
                    summary += `   âœ… å»¶è¿Ÿè¡¨ç°ä¼˜ç§€ï¼ˆ< 10msï¼‰\n`;
                } else if (avgLatency < 20) {
                    summary += `   âš ï¸ å»¶è¿Ÿè¡¨ç°è‰¯å¥½ï¼ˆ10-20msï¼‰\n`;
                } else {
                    summary += `   âŒ å»¶è¿Ÿè¡¨ç°è¾ƒå·®ï¼ˆ> 20msï¼‰\n`;
                }
                summary += '\n';
            }
            
            // éŸ³æ•ˆå¯¹é½çŠ¶æ€
            const sfxTypes = ['move', 'rotate', 'lock', 'line', 'levelup', 'gameover'];
            summary += `ğŸµ éŸ³æ•ˆå¯¹é½çŠ¶æ€:\n`;
            sfxTypes.forEach(type => {
                const result = testResults[type];
                if (result && result.success) {
                    summary += `   âœ… ${type}: å·²å¯¹é½ (${result.latency?.toFixed(2)}ms)\n`;
                } else {
                    summary += `   âŒ ${type}: æœªå¯¹é½\n`;
                }
            });
            
            summaryElement.className = successRate >= 80 ? 'status success' : 'status error';
            summaryElement.textContent = summary;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initAudio();
            
            // 5ç§’åè‡ªåŠ¨ç”Ÿæˆæ€»ç»“
            setTimeout(generateSummary, 5000);
        });
    </script>
</body>
</html>
