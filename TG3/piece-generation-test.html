<!DOCTYPE html>
<html>
<head>
    <title>æ–¹å—ç”Ÿæˆç³»ç»Ÿå¯¹æ¯”æµ‹è¯•</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #0f380f; color: #00ff00; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .comparison { display: flex; gap: 40px; }
        .version { flex: 1; }
        .stats { background: #1a1a2e; padding: 15px; margin: 10px 0; border: 1px solid #00ff00; }
        .sequence { font-size: 12px; line-height: 1.6; }
        button { background: #00ff00; color: #0f380f; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; }
        .difficulty { color: #ff6b00; font-weight: bold; }
        .chart { height: 200px; background: #1a1a2e; margin: 10px 0; padding: 10px; border: 1px solid #00ff00; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Tetris æ–¹å—ç”Ÿæˆç³»ç»Ÿå¯¹æ¯”æµ‹è¯•</h1>
        
        <div class="comparison">
            <div class="version">
                <h2>v3.0 "NESç»å…¸éšæœº"</h2>
                <button onclick="testOldSystem()">ç”Ÿæˆ100ä¸ªæ–¹å—</button>
                <div class="stats" id="oldStats"></div>
                <div class="sequence" id="oldSequence"></div>
            </div>
            
            <div class="version">
                <h2>v3.1 "7-Bagç°ä»£éšæœº"</h2>
                <button onclick="testNewSystem()">ç”Ÿæˆ100ä¸ªæ–¹å—</button>
                <div class="stats" id="newStats"></div>
                <div class="sequence" id="newSequence"></div>
            </div>
        </div>
        
        <div id="analysis"></div>
    </div>

    <script>
        // v3.0 NESç»å…¸éšæœºç³»ç»Ÿ
        class OldRandomSystem {
            constructor() {
                this.rngState = Date.now() % 0x7fffffff;
                this.lastPiece = -1;
                this.pieceNames = ['I', 'O', 'T', 'S', 'Z', 'J', 'L'];
            }
            
            randomInt(min, max) {
                this.rngState = (this.rngState * 1103515245 + 12345) & 0x7fffffff;
                return min + (this.rngState % (max - min + 1));
            }
            
            generateNextPiece() {
                let attempts = 0;
                let pieceType;
                
                do {
                    if (attempts === 0) {
                        pieceType = this.randomInt(0, 7);
                    } else {
                        pieceType = this.randomInt(0, 6);
                    }
                    attempts++;
                } while (pieceType === 7 || (attempts === 1 && pieceType === this.lastPiece));
                
                this.lastPiece = pieceType;
                return this.pieceNames[pieceType];
            }
        }
        
        // v3.1 7-Bagç°ä»£éšæœºç³»ç»Ÿ
        class NewRandomSystem {
            constructor() {
                this.pieceBag = [];
                this.bagIndex = 0;
                this.pieceNames = ['I', 'O', 'T', 'S', 'Z', 'J', 'L'];
            }
            
            createNewBag() {
                this.pieceBag = [...this.pieceNames];
                for (let i = this.pieceBag.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.pieceBag[i], this.pieceBag[j]] = [this.pieceBag[j], this.pieceBag[i]];
                }
            }
            
            generateNextPiece() {
                if (this.pieceBag.length === 0 || this.bagIndex >= this.pieceBag.length) {
                    this.createNewBag();
                    this.bagIndex = 0;
                }
                
                const pieceName = this.pieceBag[this.bagIndex];
                this.bagIndex++;
                return pieceName;
            }
        }
        
        function testOldSystem() {
            console.log('ğŸ§ª æµ‹è¯•v3.0 NESç»å…¸éšæœºç³»ç»Ÿ...');
            const system = new OldRandomSystem();
            const pieces = [];
            
            for (let i = 0; i < 100; i++) {
                pieces.push(system.generateNextPiece());
            }
            
            displayResults('old', pieces);
        }
        
        function testNewSystem() {
            console.log('ğŸ§ª æµ‹è¯•v3.1 7-Bagç°ä»£éšæœºç³»ç»Ÿ...');
            const system = new NewRandomSystem();
            const pieces = [];
            
            for (let i = 0; i < 100; i++) {
                pieces.push(system.generateNextPiece());
            }
            
            displayResults('new', pieces);
        }
        
        function displayResults(type, pieces) {
            const counts = {};
            const streaks = {};
            let currentStreak = 1;
            let maxStreak = 1;
            let currentPiece = pieces[0];
            
            // ç»Ÿè®¡æ–¹å—åˆ†å¸ƒ
            pieces.forEach(piece => {
                counts[piece] = (counts[piece] || 0) + 1;
            });
            
            // ç»Ÿè®¡è¿ç»­å‡ºç°
            for (let i = 1; i < pieces.length; i++) {
                if (pieces[i] === currentPiece) {
                    currentStreak++;
                } else {
                    streaks[currentPiece] = Math.max(streaks[currentPiece] || 0, currentStreak);
                    maxStreak = Math.max(maxStreak, currentStreak);
                    currentPiece = pieces[i];
                    currentStreak = 1;
                }
            }
            streaks[currentPiece] = Math.max(streaks[currentPiece] || 0, currentStreak);
            
            // è®¡ç®—æ–¹å·®ï¼ˆè¡¡é‡åˆ†å¸ƒå‡åŒ€æ€§ï¼‰
            const average = 100 / 7;
            const variance = Object.values(counts).reduce((acc, count) => 
                acc + Math.pow(count - average, 2), 0) / 7;
            
            // è®¡ç®—"åè¿æ°”"æŒ‡æ•°
            const iDrought = findLongestDrought(pieces, 'I');
            const badLuckScore = Math.max(0, iDrought - 12) + Math.max(0, maxStreak - 2) + variance;
            
            const statsHTML = `
                <h3>ğŸ“Š ç»Ÿè®¡ç»“æœ</h3>
                <div><strong>åˆ†å¸ƒæƒ…å†µ:</strong></div>
                ${Object.entries(counts).map(([piece, count]) => 
                    `${piece}: ${count}æ¬¡ (${(count/100*100).toFixed(1)}%)`
                ).join('<br>')}
                <br><br>
                <div><strong>è¿ç»­å‡ºç°æœ€å¤§æ¬¡æ•°:</strong> ${maxStreak}æ¬¡</div>
                <div><strong>æœ€é•¿Iæ–¹å—é—´éš”:</strong> ${iDrought}ä¸ªæ–¹å—</div>
                <div><strong>åˆ†å¸ƒæ–¹å·®:</strong> ${variance.toFixed(2)}</div>
                <div class="difficulty"><strong>"åè¿æ°”"æŒ‡æ•°:</strong> ${badLuckScore.toFixed(1)}</div>
                <div style="font-size: 10px; color: #888; margin-top: 10px;">
                    ç†æƒ³åˆ†å¸ƒ: æ¯ç§æ–¹å—çº¦14.3æ¬¡ (14-15æ¬¡)<br>
                    ç†æƒ³Ié—´éš”: â‰¤12ä¸ªæ–¹å—<br>
                    åè¿æ°”æŒ‡æ•°è¶Šé«˜ï¼Œæ¸¸æˆä½“éªŒè¶Šå·®
                </div>
            `;
            
            const sequenceHTML = `
                <h3>ğŸ”¢ æ–¹å—åºåˆ— (å‰50ä¸ª)</h3>
                <div style="font-size: 11px; word-break: break-all;">
                    ${pieces.slice(0, 50).join(' â†’ ')}
                </div>
            `;
            
            document.getElementById(type + 'Stats').innerHTML = statsHTML;
            document.getElementById(type + 'Sequence').innerHTML = sequenceHTML;
            
            // å¦‚æœä¸¤ä¸ªç³»ç»Ÿéƒ½æµ‹è¯•è¿‡äº†ï¼Œæ˜¾ç¤ºå¯¹æ¯”åˆ†æ
            if (document.getElementById('oldStats').innerHTML && document.getElementById('newStats').innerHTML) {
                showComparison();
            }
        }
        
        function findLongestDrought(pieces, targetPiece) {
            let maxDrought = 0;
            let currentDrought = 0;
            
            for (const piece of pieces) {
                if (piece === targetPiece) {
                    maxDrought = Math.max(maxDrought, currentDrought);
                    currentDrought = 0;
                } else {
                    currentDrought++;
                }
            }
            
            return Math.max(maxDrought, currentDrought);
        }
        
        function showComparison() {
            const analysisHTML = `
                <div class="stats">
                    <h2>ğŸ” ç³»ç»Ÿå·®å¼‚åˆ†æ</h2>
                    
                    <h3>æ ¸å¿ƒåŒºåˆ«ï¼š</h3>
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <h4 style="color: #ff6b00;">v3.0 NESç»å…¸ç³»ç»Ÿç‰¹ç‚¹:</h4>
                            <ul>
                                <li>å®Œå…¨éšæœºï¼Œæœ‰æ¦‚ç‡è¿ç»­å‡ºç°åŒç§æ–¹å—</li>
                                <li>å¯èƒ½å‡ºç°é•¿æ—¶é—´æ²¡æœ‰Iæ–¹å—çš„"å¹²æ—±"</li>
                                <li>åˆ†å¸ƒä¸å‡åŒ€ï¼Œç¬¦åˆäººç±»å¯¹"éšæœº"çš„è®¤çŸ¥</li>
                                <li>æœ‰æ—¶ä¼šç»™ç©å®¶"åè¿æ°”"çš„æŒ«è´¥æ„Ÿ</li>
                                <li><strong>æ›´æ¥è¿‘åŸç‰ˆNESä½“éªŒ</strong></li>
                            </ul>
                        </div>
                        
                        <div style="flex: 1;">
                            <h4 style="color: #00ff00;">v3.1 7-Bagç°ä»£ç³»ç»Ÿç‰¹ç‚¹:</h4>
                            <ul>
                                <li>æ¯7ä¸ªæ–¹å—ç¡®ä¿åŒ…å«æ‰€æœ‰ç±»å‹</li>
                                <li>Iæ–¹å—æœ€å¤šé—´éš”13ä¸ªæ–¹å—å°±ä¼šå‡ºç°</li>
                                <li>åˆ†å¸ƒæ›´å‡åŒ€ï¼Œå‡å°‘æç«¯æƒ…å†µ</li>
                                <li>æ›´"å…¬å¹³"ï¼Œå‡å°‘è¿æ°”æˆåˆ†</li>
                                <li><strong>ç°ä»£ç«æŠ€ä¿„ç½—æ–¯æ–¹å—æ ‡å‡†</strong></li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3 style="color: #ff6b00;">ä¸ºä»€ä¹ˆæ„Ÿè§‰"å˜éš¾"äº†ï¼Ÿ</h3>
                    <ol>
                        <li><strong>é¢„æœŸå¿ƒç†æ”¹å˜</strong>: 7-Bagè®©æ–¹å—å‡ºç°æ›´å¯é¢„æµ‹ï¼Œåè€Œè®©æ„å¤–æƒ…å†µæ˜¾å¾—æ›´çªå‡º</li>
                        <li><strong>ç­–ç•¥éœ€è¦è°ƒæ•´</strong>: è€ç©å®¶ä¹ æƒ¯äº†NESçš„éšæœºæ€§ï¼Œéœ€è¦é€‚åº”æ–°çš„è§„å¾‹</li>
                        <li><strong>æŠ€å·§è¦æ±‚æé«˜</strong>: ç°ä»£ç³»ç»Ÿé…åˆæ–°çš„T-Spinç­‰æŠ€å·§ï¼Œå¯¹æ“ä½œç²¾åº¦è¦æ±‚æ›´é«˜</li>
                        <li><strong>åˆ†æ•°å‹åŠ›</strong>: æ–°çš„Back-to-Backç³»ç»Ÿè®©ç©å®¶æ„Ÿå—åˆ°æ›´å¤§çš„æŠ€å·§å‹åŠ›</li>
                    </ol>
                    
                    <div style="background: #1a1a46; padding: 15px; margin: 15px 0; border-left: 4px solid #ff6b00;">
                        <strong>ğŸ’¡ å»ºè®®:</strong> å¦‚æœæƒ³è¦ç»å…¸ä½“éªŒï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ "å¤å¤æ¨¡å¼"å¼€å…³ï¼Œè®©ç©å®¶é€‰æ‹©ä½¿ç”¨å“ªç§éšæœºç³»ç»Ÿã€‚
                    </div>
                </div>
            `;
            
            document.getElementById('analysis').innerHTML = analysisHTML;
        }
        
        // è‡ªåŠ¨è¿è¡Œä¸€æ¬¡æµ‹è¯•æ¥å±•ç¤ºå·®å¼‚
        window.onload = function() {
            setTimeout(() => {
                testOldSystem();
                setTimeout(() => testNewSystem(), 500);
            }, 1000);
        };
    </script>
</body>
</html>