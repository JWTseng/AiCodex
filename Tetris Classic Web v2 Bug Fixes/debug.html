<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>Debug - Classic TETRIS</title>
  <style>
    body { font-family: monospace; margin: 20px; background: #000; color: #fff; }
    .debug { margin: 10px 0; padding: 10px; border: 1px solid #333; }
    .error { color: #ff6b6b; }
    .success { color: #51cf66; }
    .info { color: #74c0fc; }
    #game-container { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>俄罗斯方块游戏调试</h1>
  
  <div id="debug-output">
    <div class="debug info">正在初始化调试...</div>
  </div>

  <div id="game-container">
    <h2>游戏界面</h2>
    <iframe src="index.html" width="800" height="600" style="border: 2px solid #333;"></iframe>
  </div>

  <script>
    function log(message, type = 'info') {
      const output = document.getElementById('debug-output');
      const div = document.createElement('div');
      div.className = `debug ${type}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      output.appendChild(div);
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    // 检查基本功能
    function checkBasicFunctionality() {
      log('开始基本功能检查...', 'info');
      
      // 检查文件加载
      Promise.all([
        fetch('main.js').then(r => r.ok ? 'main.js' : null),
        fetch('styles.css').then(r => r.ok ? 'styles.css' : null),
        fetch('index.html').then(r => r.ok ? 'index.html' : null)
      ]).then(results => {
        results.forEach(file => {
          if (file) {
            log(`✅ ${file} 加载成功`, 'success');
          } else {
            log(`❌ 文件加载失败`, 'error');
          }
        });
      }).catch(error => {
        log(`❌ 文件检查失败: ${error.message}`, 'error');
      });
    }

    // 检查浏览器功能
    function checkBrowserFeatures() {
      log('检查浏览器功能...', 'info');
      
      if (window.AudioContext || window.webkitAudioContext) {
        log('✅ Web Audio API 支持', 'success');
      } else {
        log('❌ Web Audio API 不支持', 'error');
      }
      
      if (window.requestAnimationFrame) {
        log('✅ requestAnimationFrame 支持', 'success');
      } else {
        log('❌ requestAnimationFrame 不支持', 'error');
      }
      
      if (window.localStorage) {
        log('✅ localStorage 支持', 'success');
      } else {
        log('❌ localStorage 不支持', 'error');
      }
      
      if (document.createElement('canvas').getContext) {
        log('✅ Canvas 支持', 'success');
      } else {
        log('❌ Canvas 不支持', 'error');
      }
    }

    // 页面加载完成后运行检查
    window.addEventListener('load', () => {
      log('页面加载完成', 'info');
      checkBrowserFeatures();
      checkBasicFunctionality();
    });

    // 监听iframe中的错误
    window.addEventListener('error', (e) => {
      log(`❌ 全局错误: ${e.message}`, 'error');
    });

    // 监听未处理的Promise拒绝
    window.addEventListener('unhandledrejection', (e) => {
      log(`❌ 未处理的Promise拒绝: ${e.reason}`, 'error');
    });
  </script>
</body>
</html>
