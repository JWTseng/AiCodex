---
language: zh-CN
---

# 经典俄罗斯方块网页游戏开发规范

## 角色与目标

**角色：** 你是一名资深网页小游戏工程师。

**目标：** 按下列严格规格实现一款"经典（复古风）俄罗斯方块"网页游戏，可在桌面浏览器脱机运行（PWA 可选），不使用第三方框架。

## 交付物

单页应用：`index.html`、`styles.css`、`main.js`（可选：`assets/` 放置像素字体与音效）。

在本地双击 `index.html` 即可运行，Chrome/Edge/Firefox 最新版 60 FPS 流畅。

代码内含注释、README（安装/运行/参数说明/快捷键）。

不收集网络数据；无后端依赖。

## 游戏规则（复古版硬规则）

### 2.1 棋盘

- 网格宽度 10 列，高度 22 行
- 其中顶部 2 行为隐藏行（用于生成方块），可见行 20
- 坐标系：左上角为 (x=0, y=0)，x 右增，y 下增
- 隐藏行 y=0..1，可见行 y=2..21

### 2.2 方块（Tetromino）

**集合：** I, O, T, S, Z, J, L；无 Hold、无 Ghost、无 T-Spin 识别、无 B2B、无连击分。

**随机器：** 记忆无关的等概率随机（memoryless 1/7），不使用 7-bag。

**生成位置：** 每次新方块以4×4 包围盒的左上角锚定到**(x=3, y=0)（即隐藏区开始），若任一单元格落在已占格上则立即判定 Game Over**。

**朝向与形状定义（4×4 模板，r 行 c 列，0 基）：**

约定：列 c∈{0..3}，行 r∈{0..3}；方块实例位置由"包围盒左上角 (X,Y)"给定；形状 = {(X+c, Y+r)}。

#### I 方块
- **0°：** r1c0,r1c1,r1c2,r1c3
- **90°：** r0c2,r1c2,r2c2,r3c2
- **180°=0°，270°=90°**

#### O 方块
- **0°/90°/180°/270°：** r1c1,r1c2,r2c1,r2c2

#### T 方块
- **0°：** r1c0,r1c1,r1c2,r0c1
- **90°：** r0c1,r1c1,r2c1,r1c2
- **180°：** r1c0,r1c1,r1c2,r2c1
- **270°：** r0c1,r1c1,r2c1,r1c0

#### S 方块
- **0°：** r0c0,r0c1,r1c1,r1c2
- **90°：** r0c1,r1c1,r1c2,r2c2
- **180°=0°，270°=90°**

#### Z 方块
- **0°：** r0c1,r0c2,r1c0,r1c1
- **90°：** r0c2,r1c2,r1c1,r2c1
- **180°=0°，270°=90°**

#### J 方块
- **0°：** r1c0,r1c1,r1c2,r0c0
- **90°：** r0c1,r1c1,r2c1,r2c2
- **180°：** r1c0,r1c1,r1c2,r2c2
- **270°：** r0c1,r1c1,r2c1,r0c0

#### L 方块
- **0°：** r1c0,r1c1,r1c2,r0c2
- **90°：** r0c1,r1c1,r2c1,r0c2
- **180°：** r1c0,r1c1,r1c2,r2c0
- **270°：** r0c1,r1c1,r2c1,r2c0

### 2.3 旋转与移动

**旋转系统：** 经典无踢墙（No Kick）。尝试旋转时若任一单元越界或与已占格冲突，旋转直接失败，位置不变。

**移动：** 左右各移动一格需通过碰撞检测；移动失败则忽略该次输入。

**软降（↓）：** 在软降按下的每一帧，尝试额外下移 1 格（可与重力叠加）。

### 2.4 重力、级别、速度

帧率基准 60 FPS。重力以"每 N 帧下落 1 格"定义（近似 NES）：

| 级别 | 帧数 | 时间 |
|------|------|------|
| Lv0 | 48帧 | ≈800ms |
| Lv1 | 43帧 | ≈716.7ms |
| Lv2 | 38帧 | ≈633.3ms |
| Lv3 | 33帧 | ≈550ms |
| Lv4 | 28帧 | ≈466.7ms |
| Lv5 | 23帧 | ≈383.3ms |
| Lv6 | 18帧 | ≈300ms |
| Lv7 | 13帧 | ≈216.7ms |
| Lv8 | 8帧 | ≈133.3ms |
| Lv9 | 6帧 | ≈100ms |
| Lv10–12 | 5帧 | ≈83.3ms |
| Lv13–15 | 4帧 | ≈66.7ms |
| Lv16–18 | 3帧 | ≈50ms |
| Lv19–28 | 2帧 | ≈33.3ms |
| Lv29+ | 1帧 | ≈16.7ms |

**升级规则：** 每累计 10 行已消除行数，Level +1（从 0 起）。最高 29+。

### 2.5 锁定与消行

**锁定：** 在一次重力（或软降）尝试中，若下移 1 格即发生碰撞，则立即锁定（无锁延时、不可横移/旋转"拖拽"）。

**判行：** 每次锁定后扫描所有可见行（y=2..21）；满 10 格则记为整行，标记后统一清除。

**消行动画：** 整行格子闪烁 200ms（两次反相），随后压实。动画期间暂停输入与重力。

### 2.6 计分（复古系数）

单行/双行/三行/Tetris（四行）：
**得分 = {40, 100, 300, 1200} × (Level + 1)**

**软降加分：** 每下移 1 格 +1 分（仅按住↓期间产生的位移计分）。

无 T-Spin、B2B、连击、Perfect Clear 额外分。

### 2.7 结束条件

新方块生成时，若任一单元与现有方块重叠（包括隐藏行），Game Over。

## 操作与输入系统

### 默认键位（需在设置里可重绑）
- **← / →：** 水平移动（支持长按）
- **↓：** 软降
- **Z：** 逆时针 90°
- **X 或 ↑：** 顺时针 90°
- **P：** 暂停/继续
- **R：** 立即重新开始
- **M：** 静音/取消静音

### DAS/ARR（复古手感）
- **DAS（长按起动延时）= 150ms**
- **ARR（连续移动间隔）= 50ms**

软降为即时重复（按帧触发），不可与 DAS/ARR 冲突。

### 输入处理顺序（每帧）
读取输入 → 执行水平/旋转/软降 → 执行重力 → 若落地则锁定 → 若消行则动画与压实 → 若需要则生成新块。

## 画面与音效（复古味）

### 4.1 视觉

**颜色（经典配色，固定十六进制）：**
- I: `#00FFFF`
- O: `#FFFF00`
- T: `#800080`
- S: `#00FF00`
- Z: `#FF0000`
- J: `#0000FF`
- L: `#FFA500`

边框与网格线使用暗色（如 `#111` `#222`），棋盘背景 `#000`。

**字体：** 像素风（内置位图字体或等宽备选），HUD 使用高对比度。

**复古滤镜（可选开关，默认关闭以保证清晰）：** 轻微 CRT 扫描线与色偏。

### 4.2 UI 布局

- 左侧主棋盘
- 右侧 HUD：Score / Level / Lines、Next（仅 1 格预览）、控制提示
- 顶部标题栏："Classic TETRIS（Web）"
- 暂停时覆盖半透明层，显示 "PAUSED"

### 4.3 音效

**WebAudio 生成 8-bit/Chiptune 风格 SFX：** 移动、旋转、落地、消行、Tetris、升级、Game Over。

**BGM（循环）可选开关（默认关闭），以免打扰。**

全局音量滑杆，静音状态持久化存储。

## 技术与结构

纯 HTML + CSS + 原生 JavaScript；不要引入第三方框架或大型库。

### 推荐模块
- **Engine（主循环与时间步进，目标 60 FPS）**
- **Field（二维网格、碰撞/消行/压实）**
- **Piece（形状、旋转、下落、随机器）**
- **Input（键位映射、DAS/ARR 实现）**
- **Renderer（Canvas 绘制与动画）**
- **Audio（SFX/BGM）**
- **UI（HUD、菜单、设置、状态持久化）**

**时间步长：** 使用 `performance.now()`；稳定更新（accumulator 技法），渲染与逻辑解耦。

**存储：** localStorage 记录最高分、设置（音量、键位、像素尺寸、滤镜）。

## 可访问性与适配

**色盲友好模式：** 提供备用配色（高对比、去红绿冲突）。

**画面缩放：** 窗口自适应，保持 10×20 网格比例；最小宽度下自动隐藏非关键装饰。

**键盘可重绑；** 提供"仅键盘"完全可玩；鼠标/触屏控件（虚拟按键）为可选，默认关闭。

## 验收标准（黑盒/可操作用例）

### 生成与结束
- 在空场生成 1000 次，无越界
- 堆叠至隐藏区被占则立即 Game Over

### 旋转无踢墙
- 紧贴左/右墙尝试旋转失败
- 在空中旋转成功
- O 块旋转无变化

### 速度曲线
通过日志或 HUD 验证各级重力间隔与上表误差 ≤ 1 帧。

### 升级
每累计 10 行，Level+1；速度随级别变化。

### 计分
- 单/双/三/四消在 Lv0 得分分别为 40/100/300/1200
- Lv5 为 240/600/1800/7200
- 软降在持续按住期间，每下移 1 格计 +1 分；松开即停止计分

### 锁定
落地当帧即锁；落地帧尝试水平移动或旋转无效。

### 消行动画
整行闪烁≈200ms，期间不响应输入与重力；动画后压实。

### DAS/ARR
长按方向键 150ms 后开始以 50ms/格连移；短按仅移动 1 格。

### Next 预览
仅显示 1 个下一个方块，切换准确；无 Hold。

### 持久化
刷新页面仍保留最高分与设置。

### 静音
Mute 后所有 SFX 与 BGM 立即停止；再次开启恢复。

### 性能
桌面浏览器在 1080p 下稳定 60 FPS（开发者工具可见）。

## 可配置项（设置菜单中提供）

- **像素尺寸：** 16/20/24/32。默认 24
- **音量：** 0–100%。默认 70%。静音开关
- **颜色模式：** 标准 / 色盲友好。默认 标准
- **键位重绑（保存到 localStorage）**
- **复古滤镜：** 开/关。默认 关
- **（可选）调试开关：** 显示网格坐标与帧时序

## 非目标（请勿实现）

不实现：Hold、Ghost、现代 7-bag、墙踢（SRS/Kicks）、T-Spin 判定、连击/B2B、多人联机、道具、皮肤商店、外接排行榜。

## 质量要求

- 所有常量集中定义（如重力表、DAS/ARR、颜色、动画时长）
- 代码通过 ESLint 推荐规则（或等效自检），无未处理异常
- README 列出：规则摘要、键位、设置、构建与运行、已知限制
- 兼容 Windows/ macOS 最新主流浏览器

## 项目结构

```
tetris-classic-web/
├── index.html
├── styles.css
├── main.js
├── assets/
│   ├── font/...
│   └── audio/...
└── README.md
```