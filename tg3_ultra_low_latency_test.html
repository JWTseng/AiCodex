<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TG3 è¶…ä½å»¶è¿ŸéŸ³æ•ˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .section {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .section h2 {
            color: #ffd700;
            margin-top: 0;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }
        .game-container {
            text-align: center;
            margin: 20px 0;
        }
        .game-frame {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: #000;
            margin: 20px auto;
            display: block;
        }
        .info-box {
            background: rgba(33, 150, 243, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
        .info-box h3 {
            color: #2196f3;
            margin-top: 0;
        }
        .success-box {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            margin: 15px 0;
        }
        .success-box h3 {
            color: #4caf50;
            margin-top: 0;
        }
        .warning-box {
            background: rgba(255, 152, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
            margin: 15px 0;
        }
        .warning-box h3 {
            color: #ff9800;
            margin-top: 0;
        }
        .latency-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .latency-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        .latency-button:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: #ffd700;
            transform: translateY(-2px);
        }
        .latency-button:active {
            transform: translateY(0);
            background: rgba(255, 215, 0, 0.3);
        }
        .latency-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        .latency-button:active::before {
            left: 100%;
        }
        .latency-info {
            background: rgba(156, 39, 176, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #9c27b0;
            margin: 15px 0;
        }
        .latency-info h3 {
            color: #9c27b0;
            margin-top: 0;
        }
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }
        .metric-label {
            font-size: 14px;
            opacity: 0.8;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .comparison-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            font-weight: bold;
        }
        .comparison-table td {
            background: rgba(255, 255, 255, 0.1);
        }
        .ultra-low {
            background: rgba(76, 175, 80, 0.2) !important;
            color: #4caf50 !important;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ TG3 è¶…ä½å»¶è¿ŸéŸ³æ•ˆæµ‹è¯•</h1>
        
        <div class="success-box">
            <h3>âœ… è¶…ä½å»¶è¿Ÿä¼˜åŒ–å·²å®æ–½</h3>
            <p>å·²ç§»é™¤æ‰€æœ‰å»¶è¿Ÿæºï¼Œå®ç°çœŸæ­£çš„é›¶å»¶è¿ŸéŸ³æ•ˆå“åº”ï¼š</p>
            <ul>
                <li>ç§»é™¤ <code>requestAnimationFrame</code> åŒ…è£…</li>
                <li>è®¾ç½® <code>audioLatency = 0</code> é›¶å»¶è¿Ÿ</li>
                <li>å‡å°‘éŸ³æ•ˆé—´éš”åˆ° 5ms</li>
                <li>ä¼˜åŒ– AudioContext é…ç½®</li>
            </ul>
        </div>

        <div class="latency-info">
            <h3>âš¡ è¶…ä½å»¶è¿ŸæŠ€æœ¯ç»†èŠ‚</h3>
            <p><strong>å…³é”®ä¼˜åŒ–</strong>ï¼šå®Œå…¨æ¶ˆé™¤éŸ³æ•ˆå’Œæ“ä½œä¹‹é—´çš„å»¶è¿Ÿ</p>
            <ul>
                <li><strong>é›¶å»¶è¿Ÿæ’­æ”¾</strong>ï¼š<code>startTime = audioContext.currentTime</code></li>
                <li><strong>ç›´æ¥è°ƒç”¨</strong>ï¼šç§»é™¤æ‰€æœ‰å¼‚æ­¥åŒ…è£…ï¼Œç›´æ¥æ‰§è¡ŒéŸ³æ•ˆç”Ÿæˆ</li>
                <li><strong>æœ€å°é—´éš”</strong>ï¼š5ms éŸ³æ•ˆé—´éš”ï¼Œå‡ ä¹æ— é™åˆ¶</li>
                <li><strong>é«˜é‡‡æ ·ç‡</strong>ï¼š48kHz é‡‡æ ·ç‡ï¼Œå‡å°‘å¤„ç†å»¶è¿Ÿ</li>
                <li><strong>å°ç¼“å†²åŒº</strong>ï¼š256 æ ·æœ¬ç¼“å†²åŒºï¼Œæœ€å°åŒ–å»¶è¿Ÿ</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ¯ å»¶è¿Ÿå¯¹æ¯”</h2>
            
            <div class="comparison-table">
                <thead>
                    <tr>
                        <th>ä¼˜åŒ–é¡¹ç›®</th>
                        <th>ä¼˜åŒ–å‰</th>
                        <th>è¶…ä½å»¶è¿Ÿç‰ˆæœ¬</th>
                        <th>æ”¹è¿›æ•ˆæœ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>æ’­æ”¾å»¶è¿Ÿ</strong></td>
                        <td>1ms + requestAnimationFrame</td>
                        <td class="ultra-low">0ms ç›´æ¥æ’­æ”¾</td>
                        <td>æ¶ˆé™¤æ‰€æœ‰å»¶è¿Ÿ</td>
                    </tr>
                    <tr>
                        <td><strong>éŸ³æ•ˆé—´éš”</strong></td>
                        <td>20ms æœ€å°é—´éš”</td>
                        <td class="ultra-low">5ms æœ€å°é—´éš”</td>
                        <td>4å€æ›´å¿«é€Ÿå“åº”</td>
                    </tr>
                    <tr>
                        <td><strong>ç§»åŠ¨éŸ³æ•ˆé—´éš”</strong></td>
                        <td>80ms é—´éš”</td>
                        <td class="ultra-low">30ms é—´éš”</td>
                        <td>2.7å€æ›´å¿«é€Ÿå“åº”</td>
                    </tr>
                    <tr>
                        <td><strong>é‡‡æ ·ç‡</strong></td>
                        <td>44.1kHz</td>
                        <td class="ultra-low">48kHz</td>
                        <td>æ›´é«˜ç²¾åº¦ï¼Œæ›´ä½å»¶è¿Ÿ</td>
                    </tr>
                    <tr>
                        <td><strong>ç¼“å†²åŒºå¤§å°</strong></td>
                        <td>é»˜è®¤</td>
                        <td class="ultra-low">256 æ ·æœ¬</td>
                        <td>æœ€å°åŒ–ç¼“å†²åŒºå»¶è¿Ÿ</td>
                    </tr>
                </tbody>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ® æ¸¸æˆæµ‹è¯•</h2>
            
            <div class="info-box">
                <h3>ğŸ“‹ è¶…ä½å»¶è¿Ÿæµ‹è¯•æ­¥éª¤</h3>
                <ol>
                    <li>ç‚¹å‡»ä¸‹æ–¹"åŠ è½½TG3æ¸¸æˆ"æŒ‰é’®</li>
                    <li>ç‚¹å‡»æ¸¸æˆåŒºåŸŸæ¿€æ´»éŸ³é¢‘</li>
                    <li>æŒ‰Enteré”®å¼€å§‹æ¸¸æˆ</li>
                    <li><strong>é‡ç‚¹æµ‹è¯•</strong>ï¼šå¿«é€Ÿè¿ç»­æŒ‰é”®ï¼Œæ„Ÿå—é›¶å»¶è¿Ÿå“åº”</li>
                    <li>æµ‹è¯•å¿«é€Ÿç§»åŠ¨ã€æ—‹è½¬ï¼Œè§‚å¯ŸéŸ³æ•ˆæ˜¯å¦ç«‹å³å“åº”</li>
                </ol>
            </div>
            
            <div class="game-container">
                <button id="loadGame" class="latency-button">ğŸ® åŠ è½½TG3æ¸¸æˆ</button>
                <div id="gameFrame" style="display: none;">
                    <iframe id="tg3Game" class="game-frame" width="400" height="600" src=""></iframe>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>âš¡ å»¶è¿Ÿæµ‹è¯•</h2>
            
            <div class="warning-box">
                <h3>âš ï¸ é‡è¦æç¤º</h3>
                <p>åœ¨æµ‹è¯•ä¹‹å‰ï¼Œè¯·å…ˆç‚¹å‡»æ¸¸æˆåŒºåŸŸæ¿€æ´»éŸ³é¢‘ç³»ç»Ÿã€‚ç„¶åå°è¯•å¿«é€Ÿè¿ç»­ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ï¼Œæ„Ÿå—è¶…ä½å»¶è¿Ÿå“åº”ã€‚</p>
            </div>
            
            <div class="latency-test">
                <button class="latency-button" onclick="testUltraLatency('move')">ğŸµ ç§»åŠ¨éŸ³æ•ˆ<br><small>å¿«é€Ÿè¿ç»­ç‚¹å‡»æµ‹è¯•</small></button>
                <button class="latency-button" onclick="testUltraLatency('rotate')">ğŸ”„ æ—‹è½¬éŸ³æ•ˆ<br><small>å¿«é€Ÿè¿ç»­ç‚¹å‡»æµ‹è¯•</small></button>
                <button class="latency-button" onclick="testUltraLatency('lock')">ğŸ”’ é”å®šéŸ³æ•ˆ<br><small>å¿«é€Ÿè¿ç»­ç‚¹å‡»æµ‹è¯•</small></button>
                <button class="latency-button" onclick="testUltraLatency('line')">ğŸ“Š æ¶ˆè¡ŒéŸ³æ•ˆ<br><small>å¿«é€Ÿè¿ç»­ç‚¹å‡»æµ‹è¯•</small></button>
                <button class="latency-button" onclick="testUltraLatency('levelup')">â¬†ï¸ å‡çº§éŸ³æ•ˆ<br><small>å¿«é€Ÿè¿ç»­ç‚¹å‡»æµ‹è¯•</small></button>
                <button class="latency-button" onclick="testUltraLatency('gameover')">ğŸ’€ æ¸¸æˆç»“æŸ<br><small>å¿«é€Ÿè¿ç»­ç‚¹å‡»æµ‹è¯•</small></button>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“Š æ€§èƒ½æŒ‡æ ‡</h2>
            
            <div class="performance-metrics">
                <div class="metric-card">
                    <div class="metric-value" id="latencyValue">0ms</div>
                    <div class="metric-label">éŸ³æ•ˆå»¶è¿Ÿ</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="responseTime">0ms</div>
                    <div class="metric-label">å“åº”æ—¶é—´</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="clickCount">0</div>
                    <div class="metric-label">ç‚¹å‡»æ¬¡æ•°</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="soundCount">0</div>
                    <div class="metric-label">éŸ³æ•ˆæ’­æ”¾</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ¯ æµ‹è¯•é‡ç‚¹</h2>
            
            <div class="info-box">
                <h3>âš¡ è¶…ä½å»¶è¿ŸéªŒè¯</h3>
                <ul>
                    <li><strong>å³æ—¶å“åº”</strong>ï¼šéŸ³æ•ˆæ˜¯å¦åœ¨æŒ‰é”®ç¬é—´ç«‹å³æ’­æ”¾ï¼Ÿ</li>
                    <li><strong>è¿ç»­æ“ä½œ</strong>ï¼šå¿«é€Ÿè¿ç»­æŒ‰é”®æ—¶éŸ³æ•ˆæ˜¯å¦éƒ½èƒ½åŠæ—¶å“åº”ï¼Ÿ</li>
                    <li><strong>æ— é˜»å¡</strong>ï¼šéŸ³æ•ˆæ’­æ”¾æ˜¯å¦ä¸ä¼šå½±å“æ¸¸æˆæ“ä½œæµç•…æ€§ï¼Ÿ</li>
                    <li><strong>åŒæ­¥æ€§</strong>ï¼šéŸ³æ•ˆæ˜¯å¦ä¸è§†è§‰åé¦ˆå®Œç¾åŒæ­¥ï¼Ÿ</li>
                    <li><strong>ç¨³å®šæ€§</strong>ï¼šé•¿æ—¶é—´æ¸¸æˆåå»¶è¿Ÿæ˜¯å¦ä¿æŒä¸€è‡´ï¼Ÿ</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let audioSystem = null;
        let clickCount = 0;
        let soundCount = 0;
        let lastClickTime = 0;
        let totalResponseTime = 0;
        
        // åŠ è½½æ¸¸æˆ
        document.getElementById('loadGame').addEventListener('click', function() {
            const gameFrame = document.getElementById('gameFrame');
            const tg3Game = document.getElementById('tg3Game');
            
            tg3Game.src = './TG3/index.html';
            gameFrame.style.display = 'block';
            
            // ç›‘å¬iframeåŠ è½½å®Œæˆ
            tg3Game.onload = function() {
                console.log('TG3æ¸¸æˆåŠ è½½å®Œæˆ - è¶…ä½å»¶è¿Ÿæ¨¡å¼');
                
                // å°è¯•è·å–iframeä¸­çš„éŸ³é¢‘ç³»ç»Ÿ
                try {
                    const iframeWindow = tg3Game.contentWindow;
                    if (iframeWindow && iframeWindow.game && iframeWindow.game.audio) {
                        audioSystem = iframeWindow.game.audio;
                        console.log('éŸ³é¢‘ç³»ç»Ÿè·å–æˆåŠŸ - è¶…ä½å»¶è¿Ÿæ¨¡å¼');
                    }
                } catch (error) {
                    console.log('æ— æ³•ç›´æ¥è®¿é—®iframeéŸ³é¢‘ç³»ç»Ÿï¼Œå°†é€šè¿‡æ¸¸æˆæµ‹è¯•');
                }
            };
        });
        
        // æµ‹è¯•è¶…ä½å»¶è¿ŸéŸ³æ•ˆ
        function testUltraLatency(type) {
            const clickTime = performance.now();
            clickCount++;
            
            if (audioSystem) {
                const beforePlay = performance.now();
                audioSystem.playSFX(type);
                const afterPlay = performance.now();
                
                soundCount++;
                const responseTime = afterPlay - beforePlay;
                totalResponseTime += responseTime;
                
                // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
                document.getElementById('latencyValue').textContent = responseTime.toFixed(1) + 'ms';
                document.getElementById('responseTime').textContent = (totalResponseTime / soundCount).toFixed(1) + 'ms';
                document.getElementById('clickCount').textContent = clickCount;
                document.getElementById('soundCount').textContent = soundCount;
                
                console.log(`${type}éŸ³æ•ˆ - å“åº”æ—¶é—´: ${responseTime.toFixed(1)}ms`);
                
                // æ£€æŸ¥å»¶è¿Ÿæ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´å†…
                if (responseTime < 5) {
                    console.log('âœ… è¶…ä½å»¶è¿Ÿå“åº”æ­£å¸¸');
                } else {
                    console.log('âš ï¸ å»¶è¿Ÿè¾ƒé«˜ï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–');
                }
            } else {
                // å¦‚æœæ— æ³•ç›´æ¥è®¿é—®éŸ³é¢‘ç³»ç»Ÿï¼Œæç¤ºç”¨æˆ·é€šè¿‡æ¸¸æˆæµ‹è¯•
                alert(`è¯·åœ¨æ¸¸æˆä¸­æµ‹è¯•${type}éŸ³æ•ˆçš„è¶…ä½å»¶è¿Ÿå“åº”ã€‚\n\næ“ä½œè¯´æ˜ï¼š\n- å¿«é€Ÿè¿ç»­æŒ‰é”®æµ‹è¯•å“åº”é€Ÿåº¦\n- è§‚å¯ŸéŸ³æ•ˆæ˜¯å¦ç«‹å³æ’­æ”¾\n- æ„Ÿå—é›¶å»¶è¿Ÿçš„æ“ä½œä½“éªŒ`);
            }
            
            // æ›´æ–°ç‚¹å‡»é—´éš”
            if (lastClickTime > 0) {
                const interval = clickTime - lastClickTime;
                console.log(`ç‚¹å‡»é—´éš”: ${interval.toFixed(1)}ms`);
            }
            lastClickTime = clickTime;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.addEventListener('load', function() {
            console.log('è¶…ä½å»¶è¿ŸéŸ³æ•ˆæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ä¼˜åŒ–ç‰¹ç‚¹ï¼š');
            console.log('- é›¶å»¶è¿Ÿæ’­æ”¾');
            console.log('- ç›´æ¥è°ƒç”¨ï¼Œæ— å¼‚æ­¥åŒ…è£…');
            console.log('- 5msæœ€å°é—´éš”');
            console.log('- 48kHzé«˜é‡‡æ ·ç‡');
            console.log('- 256æ ·æœ¬å°ç¼“å†²åŒº');
        });
    </script>
</body>
</html>
